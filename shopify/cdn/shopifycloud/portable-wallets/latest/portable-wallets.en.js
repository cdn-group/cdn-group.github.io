import.meta;var Fn=Object.defineProperty,Mn=Object.defineProperties,Bn=Object.getOwnPropertyDescriptors,Oe=Object.getOwnPropertySymbols,Un=Object.prototype.hasOwnProperty,zn=Object.prototype.propertyIsEnumerable,qt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Ht=(e,t,n)=>t in e?Fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))Un.call(t,n)&&Ht(e,n,t[n]);if(Oe)for(var n of Oe(t))zn.call(t,n)&&Ht(e,n,t[n]);return e},E=(e,t)=>Mn(e,Bn(t)),u=(e,t,n)=>(Ht(e,typeof t!="symbol"?t+"":t,n),n),Vt=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},q=(e,t,n)=>(Vt(e,t,"read from private field"),n?n.call(e):t.get(e)),Q=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},$e=(e,t,n,r)=>(Vt(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),vt=(e,t,n)=>(Vt(e,t,"access private method"),n),L=function(e,t){this[0]=e,this[1]=t},J=(e,t,n)=>{var r=(o,s,l,c)=>{try{var d=n[o](s),h=(s=d.value)instanceof L,y=d.done;Promise.resolve(h?s[0]:s).then(p=>h?r(o==="return"?o:"next",s[1]?{done:p.done,value:p.value}:p,l,c):l({value:p,done:y})).catch(p=>r("throw",p,l,c))}catch(p){c(p)}},a=o=>i[o]=s=>new Promise((l,c)=>r(o,s,l,c)),i={};return n=n.apply(e,t),i[qt("asyncIterator")]=()=>i,a("next"),a("throw"),a("return"),i},M=(e,t,n)=>(t=e[qt("asyncIterator")])?t.call(e):(e=e[qt("iterator")](),t={},n=(r,a)=>(a=e[r])&&(t[r]=i=>new Promise((o,s,l)=>(i=a.call(e,i),l=i.done,Promise.resolve(i.value).then(c=>o({value:c,done:l}),s)))),n("next"),n("return"),t);const qn=":host{display:flex;align-items:center;justify-content:center}";class Hn extends HTMLElement{constructor(){var t,n;super(),u(this,"size"),u(this,"color"),this.size=(t=this.getAttribute("size"))!=null?t:"1.5rem",this.color=(n=this.getAttribute("color"))!=null?n:"gray",this.attachShadow({mode:"open"})}connectedCallback(){this.render();const t=document.createElement("style");t.textContent=qn,this.shadowRoot.appendChild(t)}render(){const t=this.shadowRoot,n='\n      width="'.concat(this.size,'"\n      height="').concat(this.size,'"\n      xmlns="http://www.w3.org/2000/svg"\n      aria-hidden="true"\n    ');switch(this.getAttribute("name")){case"warning":t.innerHTML="\n          <svg ".concat(n,' viewBox="0 0 16 14" fill="').concat(this.color,'">\n            <path d="M5.925 2.344c1.146-1.889 3.002-1.893 4.149 0l4.994 8.235c1.146 1.889.288 3.421-1.916 3.421h-10.305c-2.204 0-3.063-1.529-1.916-3.421l4.994-8.235zm1.075 1.656v5h2v-5h-2zm0 6v2h2v-2h-2z"/>\n          </svg>\n        ');break;case"close":t.innerHTML="\n          <svg ".concat(n,' viewBox="0 0 20 20" fill="').concat(this.color,'">\n            <path d="M17.1 4.3l-1.4-1.4-5.7 5.7-5.7-5.7-1.4 1.4 5.7 5.7-5.7 5.7 1.4 1.4 5.7-5.7 5.7 5.7 1.4-1.4-5.7-5.7z"/>\n          </svg>\n        ');break;default:t.innerHTML="";break}}}const Vn="#overlay{position:fixed;width:100%;height:100%;background:#0006;top:0;left:0;z-index:2147483647;animation:modalPop .3s ease-out}#modal{position:fixed;top:1em;left:50%;width:100%;max-width:460px;transform:translate(-50%,-100%);background:#fff;color:#000;border:1px solid #d0d0d0;border-radius:4px;animation:modalSlideInFromTop .3s forwards}@keyframes modalPop{0%{opacity:0}to{opacity:1}}@keyframes modalSlideInFromTop{0%{transform:translate(-50%,-100%)}to{transform:translate(-50%)}}@keyframes modalSlideInFromBottom{0%{transform:translate(-50%,100%)}to{transform:translate(-50%)}}@media only screen and (max-width: 640px){#modal{top:auto;bottom:0;animation:modalSlideInFromBottom .3s forwards}}#modal header,#modal footer{padding:1em}#modal header{display:flex;margin-bottom:2em;text-align:center;border-bottom:1px solid #d0d0d0}#title{flex-grow:2;display:flex;justify-content:center;font-size:1.6rem;margin:0}#title svg-icon{margin-right:.25em}#content{text-align:left;padding:0 1em 1em;overflow:auto;max-height:84vh}#modal #content p{margin:0}#close-icon,#close-button{cursor:pointer}#close-icon{min-width:24px;background:transparent;padding:0;border:none}#close-button{width:100%;padding:1em;color:#fff;background-color:#1773b0;border:none;border-radius:4px}#close-button:hover,#close-button:active{background:#136f99}#close-button:active,#close-button:focus{box-shadow:0 0 0 4px #1990c640}";var Ze=/^\s*at .*(\S+:\d+|\(native\))/m,Wn=/^(eval@)?(\[native code])?$/;function jn(e){return e.stack?e.stack.match(Ze)?Kn(e):Gn(e):[]}function Xe(e){if(e.indexOf(":")===-1)return[e];let t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]?Number(t[2]):void 0,t[3]?Number(t[3]):void 0]}function Kn(e){return e.stack.split("\n").filter(t=>!!t.match(Ze)).map(t=>{let n=t.replace(/^\s+/,"").replace(/^.*?\s+/,""),r=n.match(/ (\(.+\)$)/);n=r?n.replace(r[0],""):n;let a=Xe(r?r[1]:n),i=r&&n||void 0,o=["eval","<anonymous>"].indexOf(a[0])>-1?void 0:a[0];return{method:i,file:o,lineNumber:a[1],columnNumber:a[2]}})}function Gn(e){return e.stack.split("\n").filter(t=>!t.match(Wn)).map(t=>{if(t.indexOf("@")===-1&&t.indexOf(":")===-1)return{method:t};let n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(n),a=r&&r[1]?r[1]:void 0,i=Xe(t.replace(n,""));return{method:a,file:i[0],lineNumber:i[1],columnNumber:i[2]}})}var Fe="5",Yn=class{constructor(e){u(this,"breadcrumbs",[]),u(this,"apiKey"),u(this,"plugins"),u(this,"appId"),u(this,"appType"),u(this,"appVersion"),u(this,"releaseStage"),u(this,"locale"),u(this,"userAgent"),u(this,"metadata"),u(this,"onError"),u(this,"onPostErrorListeners",[]);var t;this.apiKey=e.apiKey,this.appType=e.appType,this.appId=e.appId,this.appVersion=e.appVersion,this.releaseStage=e.releaseStage,this.locale=e.locale,this.userAgent=e.userAgent,this.metadata=e.metadata,this.onError=e.onError,this.plugins=(t=e.plugins)!=null?t:[],this.plugins.forEach(n=>n.load(this)),this.leaveBreadcrumb("Bugsnag started",void 0,"state")}leaveBreadcrumb(e,t,n="manual"){this.breadcrumbs.push({name:e,metaData:t,type:n,timestamp:new Date().toISOString()})}notify(e,{errorClass:t,severity:n,severityType:r,handled:a=!0,metadata:i,context:o}={}){var s,l;let c=f(f({},this.metadata),i),d=this.buildBugsnagEvent({error:e,errorClass:t,severityType:r,handled:a,severity:n,metadata:c,context:o});if(((l=(s=this.onError)==null?void 0:s.call(this,d))==null||l)&&this.releaseStage!=="development"){let h=this.sendToBugsnag(d);return this.onPostErrorListeners.forEach(y=>y(d)),h}return Promise.resolve()}addOnPostError(e){this.onPostErrorListeners.push(e)}buildBugsnagEvent({error:e,errorClass:t,severity:n="error",severityType:r="handledException",handled:a,metadata:i={},context:o}){let s=new Date().toISOString(),{breadcrumbs:l,appId:c,appType:d,appVersion:h,releaseStage:y,locale:p,userAgent:v}=this;return{payloadVersion:Fe,exceptions:[{errorClass:t!=null?t:e.name,stacktrace:Qn(c,e),message:e.message}],severity:n,severityReason:{type:r},unhandled:!a,app:{id:c,type:d,version:h,releaseStage:y},device:{time:s,locale:p,userAgent:v},breadcrumbs:l,context:o,metaData:i}}async sendToBugsnag(e){let{apiKey:t}=this,n={apiKey:t,notifier:{name:"Bugsnag JavaScript",version:"7.22.2",url:"https://github.com/bugsnag/bugsnag-js"},events:[e]};try{await fetch("https://notify.bugsnag.com/",{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":t,"Bugsnag-Payload-Version":Fe,"Bugsnag-Sent-At":e.device.time},body:JSON.stringify(n)})}catch(r){console.warn("[bugsnag-light] failed to send an event"),console.warn(r)}}};function Qn(e,t){return jn(t).map(n=>{var r,a,i,o;let s=(r=n.file)==null?void 0:r.includes(e);return{method:(a=n.method)!=null?a:"",file:(i=n.file)!=null?i:"",lineNumber:(o=n.lineNumber)!=null?o:0,columnNumber:n.columnNumber,inProject:s}})}function Jn(e){let t=window.onerror;window.onerror=(n,r,a,i,o)=>{o&&e.notify(o,{severityType:"unhandledException",handled:!1}),typeof t=="function"&&t.apply(window.onerror,[n,r,a,i,o])}}function Zn(e){window.addEventListener("unhandledrejection",({reason:t})=>{t&&e.notify(t,{severityType:"unhandledPromiseRejection",handled:!1})})}function yt(e){try{const t=new RegExp("(^| )".concat(e,"=([^;]+)")).exec(document.cookie);if(t){const n=t[2];try{return decodeURIComponent(n)}catch(r){return n}}return null}catch(t){return null}}const Gt={BRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--branded",UNBRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--unbranded",MORE_PAYMENT_OPTION_BUTTON:"shopify-payment-button__more-options",HIDDEN:"shopify-payment-button__button--hidden"},Xn="wallet-cart-button",tr={DARK:"apple-pay--dark",LIGHT:"apple-pay--light"},er="_shopify_y",tn=6,nr="discount_code",le="https://static-na.payments-amazon.com/checkout.js",rr={CURRENCY_CHANGE:"wallet_currency_change"},ar=["Load failed","Failed to fetch","when attempting to fetch resource"],or=["Chrome-Lighthouse"],Yt={};function ir(e){return!e.exceptions[0]||(lr(e),sr())?!1:cr(e)}function sr(){const e=navigator.userAgent;return or.some(t=>e.includes(t))}function lr(e){var t,n;e.context=window.location.pathname,e.request||(e.request={}),e.request.url=window.location.href,e.device.orientation=(n=(t=window.screen)==null?void 0:t.orientation)==null?void 0:n.type,e.metaData=f(f({},Yt),e.metaData)}function cr(e){var t,n,r;const a=e.exceptions[0];return ar.some(i=>{var o,s;return(s=(o=a.message)==null?void 0:o.includes(i))!=null?s:!1})||a.errorClass==="SilencedError"||a.stacktrace.some(i=>{var o;return(o=i.file)==null?void 0:o.includes("spin.dev")})||a.errorClass==="OpenTelemetryClientError"&&((t=a.message)!=null&&t.match(/Server responded with ([45]\d\d|undefined)/)||(n=a.message)!=null&&n.includes("error found in #10 byte"))||(r=a.message)!=null&&r.includes("GraphQL mutation failed with status 404")?!1:a.stacktrace.some(i=>!!(i!=null&&i.inProject))}var Je;const ur={apiKey:"cb577dc231be1c7494db8a63441ef66b",appId:"portable-wallets",appVersion:"0.0.0-09d5f2af5aefa9190a3f6b855b76370acb06ff31",releaseStage:"production",locale:"en",userAgent:navigator.userAgent,metadata:{user:{id:(Je=yt(er))!=null?Je:"unknown"}},onError:ir},g=new Yn(ur);function ce(e){for(const[t,n]of Object.entries(e))Yt[t]=f(f({},Yt[t]),n)}var en={en:{instruments_copy:{checkout:{buy_now:"Buy it now"}},error_dialogs:{checkout:{title:"Checkout unavailable",generic_error:"Checkout is currently unavailable due to technical problems. Please try again in a few minutes.",button_text:"Close"},product:{out_of_stock:"This item is no longer available."},wallet:{title:"%{wallet} unavailable",generic_error:"There was an issue with %{wallet}. Try again or use a different payment method.",buy_with_prime:{empty_line_items:{title:"Buy with Prime no longer available",content:"Items that were eligible for Buy with Prime are no longer in your cart."}}}},more_payment_options:"More payment options",subscriptions:{buyer_consent:"One or more of the items in your cart is a recurring or deferred purchase. By continuing, I agree to the %{subscriptionPolicyLink} and authorize you to charge my payment method at the prices, frequency and dates listed on this page until my order is fulfilled or I cancel, if permitted.",cancellation_policy:"cancellation policy",subscription_policy:"Subscription policy",policy_not_found:"The subscription policy could not be found. Refresh the page or contact us for more information."},shipping_methods:{connect_shipping_methods:"%{methodOne} and %{methodTwo}"},order_summary:{total:"Total",subtotal:"Subtotal",duties:"Duties",taxes:"Taxes",shipping:"Shipping",shipping_one_time_purchase:"Shipping (One-time purchase)",shipping_subscription:"Shipping (Subscription)",discount:"Discount",subscriptions:{recurring_total_tooltip_line:"Does not include shipping, tax, duties, or any applicable discounts",recurring_totals:"%{fixedPrice} every %{interval}",recurring_totals_with_policies:{one:"First payment %{fixedPrice}, then %{recurringPrice} every %{interval}",other:"First %{count} payments %{fixedPrice} each, then %{recurringPrice} every %{interval}"},recurring_total_intervals:{day:{one:"day",other:"%{count} days"},month:{one:"month",other:"%{count} months"},week:{one:"week",other:"%{count} weeks"},year:{one:"year",other:"%{count} years"}}}},brand:{amazon_pay:"Amazon Pay",apple_pay:"Apple Pay"},buy_with_button_content:"Buy with {{ICON}}",errors:{missing:{email:"Enter an email address",first_name:"Enter a first name",last_name:"Enter a last name",address1:"Enter an address",address2:"Enter an apartment, suite, etc.",city:"Enter a city",zone:"Select a state / province",phone:"Enter a phone number",postal_code:"Enter a ZIP / postal code"},invalid:{email:"Enter a valid email",first_name:"Enter a valid first name",last_name:"Enter a valid last name",address1:"Enter a valid address",address2:"Enter a valid apartment, suite, etc.",city:"Enter a valid city",zone:"Select a valid state / province",country:"Select a country / region",phone:"Enter a valid phone number",postal_code:"Enter a valid zip / postal code"}}}};en.en;function Ot(){return new Qt(en)}class Me extends Error{constructor(t,n){const r="i18n: Missing or invalid translation '".concat(t,"' in '").concat(n,"'");super(r)}}class dr extends Error{constructor(t,n,r){const a="i18n: Missing translation template key '".concat(t,"' for '").concat(n,"' in '").concat(r,"'");super(a)}}class hr extends Error{constructor(t,n,r){const a="i18n: Invalid pluralization for '".concat(t,"':'").concat(n,"' in '").concat(r,"'");super(a)}}var Ct,z,Tt,nn,Dt,rn,Nt,an;const be=class $n{constructor(t){Q(this,Tt),Q(this,Dt),Q(this,Nt),Q(this,Ct,void 0),Q(this,z,$n.getDefaultLanguage()),$e(this,Ct,t)}static getDefaultLanguage(){return"en"}get locale(){return q(this,z)}translate(t,n={}){var r;const a=t.split(".");let i=q(this,Ct)[q(this,z)];try{for(const o of a)switch(typeof i){case"object":i=i[o];break;case"string":case"undefined":throw new Me(t,q(this,z))}if(vt(this,Tt,nn).call(this,i,n)){if(typeof i=="string")throw new hr(t,i,q(this,z));i=i[vt(this,Dt,rn).call(this,i,n.count)]}if(typeof i!="string")throw new Me(t,q(this,z));return vt(this,Nt,an).call(this,i,n)}catch(o){return g.notify(o),(r=n.defaultValue)!=null?r:t}}};Ct=new WeakMap,z=new WeakMap,Tt=new WeakSet,nn=function(e,t){return typeof e!="string"&&t.count!=="undefined"},Dt=new WeakSet,rn=function(e,t){let n=t===1?"one":"other";return t===0&&typeof e!="string"&&e.zero!=="undefined"&&(n="zero"),n},Nt=new WeakSet,an=function(e,t={}){const n=e.match(/%\{.+?\}/g);return n?n.reduce((r,a)=>{const i=a.replace(/%\{(.*)\}/,"$1");return t[i]?r.replace(a,t[i]):(g.notify(new dr(i,e,q(this,z))),r)},e):e};let Qt=be;var k=(e=>(e.CartPage="cart_page",e.CartAjax="cart_ajax",e.ProductPage="product",e.Unknown="unknown",e))(k||{}),pt=(e=>(e.CartChange="/cart/change",e.CartUpdate="/cart/update",e.CartAdd="/cart/add",e.CartClear="/cart/clear",e))(pt||{}),bt=(e=>(e.OneTimePurchase="ONE_TIME_PURCHASE",e.Subscription="SUBSCRIPTION",e))(bt||{}),pr=0;function at(e){return"__private_"+pr+++"_"+e}function S(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function ue(e){return Object.entries(e).map(([t,n])=>({key:t,value:{stringValue:String(n)}}))}const on=1,mr=yr(5,2,12);function yr(e,t,n){const r=[0];for(let a=0;a<n;a++){const i=Math.floor(e*t**a);r.push(i)}return r}var st=at("exporter"),B=at("attributes"),x=at("metrics");class fr{constructor({exporter:t,attributes:n}){Object.defineProperty(this,st,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:[]}),S(this,st)[st]=t,S(this,B)[B]=n!=null?n:{}}addAttributes(t){S(this,B)[B]=f(f({},S(this,B)[B]),t)}histogram({name:t,value:n,unit:r,bounds:a,attributes:i}){const o=Date.now()*1e6;S(this,x)[x].push({name:t,type:"histogram",value:n,unit:r,timeUnixNano:o,attributes:i,bounds:a})}counter({name:t,value:n,unit:r,attributes:a}){const i=Date.now()*1e6;S(this,x)[x].push({name:t,type:"counter",value:n,unit:r,timeUnixNano:i,attributes:a})}gauge({name:t,value:n,unit:r,attributes:a}){const i=Date.now()*1e6;S(this,x)[x].push({name:t,type:"gauge",value:n,unit:r,timeUnixNano:i,attributes:a})}async exportMetrics(){const t={};S(this,x)[x].forEach(r=>{switch(r.attributes=f(f({},S(this,B)[B]),r.attributes),r.type){case"histogram":gr(t,r);break;case"counter":br(t,r);break;case"gauge":wr(t,r);break}});const n=Object.values(t);n.length!==0&&(S(this,x)[x]=[],await S(this,st)[st].exportMetrics(n))}}function gr(e,t){var n;const{name:r,value:a,unit:i,timeUnixNano:o,attributes:s}=t,l=(n=t.bounds)!==null&&n!==void 0?n:mr,c=new Array(l.length+1).fill(0);e[r]||(e[r]={name:r,unit:i||"1",histogram:{aggregationTemporality:on,dataPoints:[]}});for(let d=0;d<c.length;d++){const h=l[d];if(h===void 0)c[d]=1;else if(a<=h){c[d]=1;break}}e[r].histogram.dataPoints.push({startTimeUnixNano:o,timeUnixNano:o,count:1,sum:a,min:a,max:a,bucketCounts:c,explicitBounds:l,attributes:ue(s!=null?s:{})})}function br(e,t){const{name:n,value:r,unit:a,timeUnixNano:i,attributes:o}=t;e[n]||(e[n]={name:n,unit:a||"1",sum:{aggregationTemporality:on,isMonotonic:!0,dataPoints:[]}}),e[n].sum.dataPoints.push({startTimeUnixNano:i,timeUnixNano:i,asDouble:r,attributes:ue(o!=null?o:{})})}function wr(e,t){const{name:n,value:r,unit:a,timeUnixNano:i,attributes:o}=t;e[n]||(e[n]={name:n,unit:a||"1",gauge:{dataPoints:[]}}),e[n].gauge.dataPoints.push({startTimeUnixNano:i,timeUnixNano:i,asDouble:r,attributes:ue(o!=null?o:{})})}var lt=at("url"),ct=at("serviceName"),ut=at("logger");class Cr{constructor(t,n,r){Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),S(this,lt)[lt]=t,S(this,ct)[ct]=n,S(this,ut)[ut]=r==null?void 0:r.logger}async exportMetrics(t){var n;const r={resourceMetrics:[{resource:{attributes:[{key:"service.name",value:{stringValue:S(this,ct)[ct]}}]},scopeMetrics:[{scope:{name:"open-telemetry-mini-client",version:"0.3.3",attributes:[]},metrics:t}]}]},a=await fetch(S(this,lt)[lt],{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if((n=S(this,ut)[ut])===null||n===void 0||n.log({status:a.status}),!a.ok){if(a.status===400){const i=await a.text();throw new St("Invalid OpenTelemetry Metrics: ".concat(i))}if(a.status===429||a.status===503){const i=await a.json(),o=a.headers.get("Retry-After"),s=o?{seconds:Number(o)}:void 0;throw new St("Server did not accept metrics",{errorData:i,retryAfter:s,metrics:t})}throw new St("Server responded with ".concat(a.status))}}}class St extends Error{constructor(t,n){super(t),this.metadata=void 0,this.name="OpenTelemetryClientError",this.metadata=n}}const vr="https://otlp-http-production.shopifysvc.com/v1/metrics",Ar="portable_wallets";class Er{constructor(t){this.exporter=t}async exportMetrics(t){var n;try{await this.exporter.exportMetrics(t)}catch(r){if(r instanceof St){const a=(n=r.metadata)==null?void 0:n.retryAfter;if(a){await new Promise(i=>{setTimeout(()=>{this.exportMetrics(t),i()},a.seconds*1e3)});return}}throw r}}}const Sr=new Cr(vr,Ar),_r=new Er(Sr),_=new fr({exporter:_r}),mt=[];function F(e,t,n){if(window.customElements==null)return;const r=t;window.customElements.get(e)||(window.customElements.define(e,r),n!=null&&n.isChildCustomElement&&mt.push(e))}function Pr(){var e;const t=(e=window.Shopify)==null?void 0:e.CartType;let n=k.ProductPage;return window.Shopify?t===k.CartAjax?n=k.CartAjax:t===k.CartPage&&(n=k.CartPage):n=k.Unknown,n}function Jt(e){return Number(e).toFixed(2)}function $t(e){if(!(!e||!e.id||!e.id.includes("gid://shopify/Cart/")))return e.id.replace("gid://shopify/Cart/","")}function Z(){let e;return[new Promise(t=>e=t),e]}function ot(e){_.exportMetrics(),window.location.assign(e)}class Ir extends HTMLElement{constructor(){super(),u(this,"overflow"),u(this,"formerFocus"),this.attachShadow({mode:"open"}),this.overflow="",this.formerFocus=document.activeElement}connectedCallback(){const t=Ot();this.render(t);const n=this.shadowRoot,r=n.getElementById("modal");n.querySelectorAll("button").forEach(o=>o.addEventListener("click",this.closeModal.bind(this)));const a=n.getElementById("overlay");a==null||a.addEventListener("click",o=>this.handleOutsideClick(o,r)),document.addEventListener("keydown",this.handleEscapeKey.bind(this));const i=document.createElement("style");i.textContent=Vn,n.appendChild(i),this.overflow=document.body.style.overflow,document.body.style.overflow="hidden",this.trapFocus(r,n),F("svg-icon",Hn)}trapFocus(t,n){if(!t)return;const r=t.querySelectorAll("a[href], button"),a=Array.from(r),i=a[0],o=a[a.length-1];t.addEventListener("keydown",s=>{s.key==="Tab"&&!s.shiftKey&&n.activeElement===o&&(s.preventDefault(),i.focus()),s.key==="Tab"&&s.shiftKey&&n.activeElement===i&&(s.preventDefault(),o.focus())}),i.focus()}handleOutsideClick(t,n){n&&(n.contains(t.target)||this.closeModal())}handleEscapeKey(t){t.key==="Escape"&&this.closeModal()}closeModal(){var t;document.body.style.overflow=this.overflow,this.remove(),this.formerFocus&&"focus"in(this==null?void 0:this.formerFocus)&&typeof this.formerFocus.focus=="function"&&((t=this.formerFocus)==null||t.focus())}render(t){const n=this.getAttribute("title"),r=this.getAttribute("has-close-button"),a=t.translate("error_dialogs.checkout.button_text"),i='\n      <footer>\n        <button type="button" id="close-button" tabindex="0">'.concat(a,"</button>\n      </footer>\n    ");this.shadowRoot.innerHTML='\n      <div id="overlay">\n        <div id="modal" role="dialog" aria-modal="true" aria-labelledby="title">\n          <header>\n            <h2 id="title">\n              '.concat(n,'\n            </h2>\n            <button type="button" id="close-icon" aria-label=').concat(a,' tabindex="0">\n              <svg-icon name="close" color="gray"></svg-icon>\n            </button>\n          </header>\n          <div id="content">\n            <p><slot></slot></p>\n          </div>\n          ').concat(r?i:"","\n        </div>\n      </div>\n    ")}}function sn(e){e.setAttribute("tabindex","0")}function Ft(e="button"){const t=document.createElement("button");return sn(t),t.type=e,e!=="submit"&&(t.role="button"),t}function kr(){const e=document.createElement("a");return sn(e),e}function nt(e,t){for(const[n,r]of Object.entries(t))e.setAttribute(n,r)}function ft(e,t){for(const[n,r]of Object.entries(t))e.style.setProperty(n,r)}function $(e,t){const n=document.createElement("top-level-modal");n.textContent=t,nt(n,{"data-testid":"top-level-modal","has-close-button":"true",title:'<svg-icon name="warning" color="red"></svg-icon> '.concat(e)}),document.body.appendChild(n)}function Tr(e,t){const n=document.createElement("top-level-modal");n.innerHTML=t,nt(n,{"data-testid":"top-level-modal",title:e}),document.body.appendChild(n)}F("top-level-modal",Ir);class ln extends HTMLElement{get buyerCountry(){return this.getAttribute("buyer-country")}get buyerCurrency(){const t=this.getAttribute("buyer-currency");if(t==null)throw new Error("WalletElement buyer-currency is null");return t}get accessToken(){return this.getAttribute("access-token")}get disabled(){const t=this.getAttribute("disabled");return t==="true"||t===""}set disabled(t){t?this.setAttribute("disabled","true"):this.removeAttribute("disabled")}get hasSellingPlan(){const t=this.getAttribute("has-selling-plan");return t==="true"||t===""}set hasSellingPlan(t){t?this.setAttribute("has-selling-plan",""):this.removeAttribute("has-selling-plan")}get isShippingRequired(){const t=this.getAttribute("requires-shipping");return t==="true"||t===""}set isShippingRequired(t){t?this.setAttribute("requires-shipping",""):this.removeAttribute("requires-shipping")}}const Dr=70;class gt{constructor(t,n,r,a){u(this,"red"),u(this,"green"),u(this,"blue"),u(this,"opacity"),this.red=t||0,this.green=n||0,this.blue=r||0,this.opacity=typeof a>"u"?1:a}getLuminance(){const t=this.red&255,n=this.green&255,r=this.blue&255;return t*.2126+n*.7152+r*.0722}isDark(){return this.opacity===0?!1:this.getLuminance()/this.opacity<Dr}blendWith(t,n){this.opacity=1-(1-t.opacity)*(1-n.opacity),this.red=this.blend(t.red,n.red,t,n),this.green=this.blend(t.green,n.green,t,n),this.blue=this.blend(t.blue,n.blue,t,n)}blend(t,n,r,a){return Math.round(t*r.opacity/this.opacity+n*a.opacity*(1-r.opacity)/this.opacity)}}function Nr(e){const t=[...e];let n=new gt(0,0,0,0),r=new gt(255,255,255,1),a=t.shift();for(;a;)n.opacity>0&&a.opacity>0?(r=new gt(0,0,0,0),r.blendWith(a,n)):a.opacity>0?r=a:r=n,n=r,a=t.shift();return r}const Zt=new gt(255,255,255,1);function xr(e){const t=[];let n=e;for(;n.parentElement;){n=n.parentElement;const r=window.getComputedStyle(n).backgroundColor,a=Rr(r);if(r&&t.push(a),a.opacity===1)break}try{return Nr(t.reverse())}catch(r){return g.notify(new Error("[BackgroundDetection] Failed to blend colors for element ".concat(e.outerHTML))),Zt}}function Rr(e){if(!e)return Zt;try{const t=e.split("(")[1].split(")")[0].replace(" ","").split(",");return new gt(Number(t[0]),Number(t[1]),Number(t[2]),typeof t[3]>"u"?1:Number(t[3]))}catch(t){g.notify(new Error("[BackgroundDetection] Failed to convert rgbString to array ".concat(e)))}return Zt}class W extends ln{constructor(){super(),u(this,"i18n"),u(this,"dataSource"),u(this,"apiClient"),u(this,"classNames"),u(this,"onRendered"),u(this,"setI18n"),u(this,"setDataSource"),u(this,"setApiClient"),u(this,"setClassNames"),u(this,"parsedWalletParams"),this.onRendered=()=>{},[this.i18n,this.setI18n]=Z(),[this.dataSource,this.setDataSource]=Z(),[this.apiClient,this.setApiClient]=Z(),[this.classNames,this.setClassNames]=Z()}attributeChangedCallback(t,n,r,a){n!==r&&t==="disabled"&&a&&(r?(a.setAttribute("aria-disabled","true"),a.setAttribute("disabled","true")):(a.removeAttribute("aria-disabled"),a.removeAttribute("disabled")))}get pageType(){return this.getAttribute("page-type")}get buttonTheme(){return xr(this).isDark()?"LIGHT":"DARK"}get walletParams(){var t;if(this.parsedWalletParams===void 0)try{this.parsedWalletParams=JSON.parse((t=this.getAttribute("wallet-params"))!=null?t:"{}")}catch(n){throw new Error("Error while parsing wallet-params JSON: ".concat(n))}return this.parsedWalletParams}}const Lr="#more-payment-options-link{cursor:pointer}";var w=(e=>(e.InvalidLanguage="Variable $language of type LanguageCode was provided invalid value",e.InvalidCountry="Variable $country of type CountryCode was provided invalid value",e.MissingCartId="Variable $cartId of type ID! was provided invalid value",e.BuyerIdentityInvalidCountry="Variable $buyerIdentity of type CartBuyerIdentityInput! was provided invalid value for countryCode",e.BuyerIdentityInvalidPhone="INVALID: buyerIdentity.phone",e.BuyerIdentityEmailRequired="BUYER_IDENTITY_EMAIL_REQUIRED",e.DeliveryFirstNameInvalid="DELIVERY_FIRST_NAME_INVALID",e.DeliveryFirstNameRequired="DELIVERY_FIRST_NAME_REQUIRED",e.DeliveryLastNameInvalid="DELIVERY_LAST_NAME_INVALID",e.DeliveryLastNameRequired="DELIVERY_LAST_NAME_REQUIRED",e.DeliveryAddress1Required="DELIVERY_ADDRESS1_REQUIRED",e.DeliveryAddress1Invalid="DELIVERY_ADDRESS1_INVALID",e.DeliveryAddress2Required="DELIVERY_ADDRESS2_REQUIRED",e.DeliveryAddress2Invalid="DELIVERY_ADDRESS2_INVALID",e.DeliveryCityRequired="DELIVERY_CITY_REQUIRED",e.DeliveryCityInvalid="DELIVERY_CITY_INVALID",e.DeliveryZoneNotFound="DELIVERY_ZONE_NOT_FOUND",e.DeliveryZoneRequiredForCountry="DELIVERY_ZONE_REQUIRED_FOR_COUNTRY",e.DeliveryPostalCodeInvalid="DELIVERY_POSTAL_CODE_INVALID",e.DeliveryInvalidPostalCodeForZone="DELIVERY_INVALID_POSTAL_CODE_FOR_ZONE",e.DeliveryInvalidPostalCodeForCountry="DELIVERY_INVALID_POSTAL_CODE_FOR_COUNTRY",e.DeliveryPostalCodeRequired="DELIVERY_POSTAL_CODE_REQUIRED",e.DeliveryCountryInvalid="INVALID: buyerIdentity.deliveryAddressPreferences.0.deliveryAddress.country",e.DeliveryPhoneNumberRequired="DELIVERY_PHONE_NUMBER_REQUIRED",e.DeliveryPhoneNumberInvalid="DELIVERY_PHONE_NUMBER_INVALID",e.MerchandiseOutOfStock="MERCHANDISE_OUT_OF_STOCK",e.InvalidQuantity="INVALID: input.lines.0.quantity",e.UnacceptablePaymentsAmount="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT",e.DeliveryNotAvailable="DELIVERY_NO_DELIVERY_AVAILABLE",e.PendingDeliveryGroups="PENDING_DELIVERY_GROUPS",e.InvalidPaymentAmount="INVALID_PAYMENT: payment.amount",e))(w||{});const Or="https://monorail-edge.shopifysvc.com",$r="/v1/produce";function Fr(){if(typeof crypto<"u"&&crypto&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const e=new Array(36);for(let t=0;t<36;t++)e[t]=Math.floor(Math.random()*16);return e[14]=4,e[19]=e[19]&=-5,e[19]=e[19]|=8,e[8]=e[13]=e[18]=e[23]="-",e.map(t=>t.toString(16)).join("")}function Mr(e){const t={"Content-Type":"application/json; charset=utf-8","X-Monorail-Edge-Event-Created-At-Ms":(e&&e.eventCreatedAtMs||Date.now()).toString(),"X-Monorail-Edge-Event-Sent-At-Ms":Date.now().toString(),"X-Monorail-Edge-Client-Message-Id":(e&&e.clientMessageId||Fr()).toString()};return e&&e.userAgent&&(t["User-Agent"]=e.userAgent),e&&e.remoteIp&&(t["X-Forwarded-For"]=e.remoteIp),t}async function Br({endpoint:e,event:t,keepalive:n}){return fetch(e!=null?e:Or+$r,{method:"post",headers:Mr(t.metadata),body:JSON.stringify({schema_id:t.schemaId,payload:t.payload}),keepalive:n})}var R=(e=>(e.Decelerated="portable_wallets_decelerated",e.InitCompleted="portable_wallets_init_completed",e.InstrumentLoadTime="portable_wallets_instrument_load_time",e.InstrumentLoadNotEligible="portable_wallets_instrument_load_not_eligible",e.MonorailProduceError="portable_wallets_monorail_produce_error",e.SheetClicked="portable_wallets_sheet_clicked",e.SheetCancelled="portable_wallets_sheet_cancelled",e.AuthorizationAttempt="portable_wallets_authorization_attempt",e.AuthorizationComplete="portable_wallets_authorization_complete",e.CartTokenMissing="portable_wallets_cart_token_missing",e))(R||{}),V=(e=>(e.InstrumentSdkLoaded="portable_wallets_instrument_sdk_loaded",e.InstrumentSdkFailed="portable_wallets_instrument_sdk_failed",e.InstrumentSdkEligible="portable_wallets_instrument_sdk_eligible",e.InstrumentSdkNotEligible="portable_wallets_instrument_sdk_not_eligible",e))(V||{});const Ur=["Chrome-Lighthouse"];function zr(){const e=navigator.userAgent;return Ur.some(t=>e.includes(t))}async function qr(e){if(zr())return;g.leaveBreadcrumb("monorail event produced to ".concat(e.schemaId),e);let t;try{t=await Br({event:e})}catch(n){}t!=null&&t.ok||_.counter({name:R.MonorailProduceError,value:1,attributes:{schemaId:e.schemaId}})}const Be="shopify_wallet_checkout_track/6.2";async function N(e){var t,n,r,a,i,o,s,l,c,d,h,y;(n=(t=window==null?void 0:window.ShopifyAnalytics)==null?void 0:t.lib)!=null&&n.trekkie||await new Promise(De=>{const Te=setInterval(()=>{var Le,Re;(Re=(Le=window==null?void 0:window.ShopifyAnalytics)==null?void 0:Le.lib)!=null&&Re.trekkie&&(clearInterval(Te),De())},100),pi=setTimeout(()=>{clearInterval(Te),clearTimeout(pi),De()},7e3)});const p=(i=(a=(r=window.ShopifyAnalytics)==null?void 0:r.lib)==null?void 0:a.trekkie)==null?void 0:i.defaultAttributes,v={uniqToken:(o=p==null?void 0:p.uniqToken)!=null?o:"",visitToken:(s=p==null?void 0:p.visitToken)!=null?s:"",microSessionId:(l=p==null?void 0:p.microSessionId)!=null?l:"",microSessionCount:(c=p==null?void 0:p.microSessionCount)!=null?c:0,shopId:(d=p==null?void 0:p.shopId)!=null?d:0,themeId:p==null?void 0:p.themeId,themeCityHash:(h=p==null?void 0:p.themeCityHash)!=null?h:"",contentLanguage:(y=p==null?void 0:p.contentLanguage)!=null?y:"",referer:p==null?void 0:p.referer},{uniqToken:C,visitToken:G,microSessionId:ve,microSessionCount:Se,shopId:Pe,themeId:Ie,themeCityHash:A,contentLanguage:we,referer:Ae}=v,{event:Y,eventSubtype:Ce,checkoutToken:ci,instrumentId:ui,ttl:di,errorReason:hi}=e,xe={schemaId:Be,payload:{event:Y,event_subtype:Ce,checkout_token:ci,app_name:"storefront",page_type:Pr(),instrument_id:ui,ttl:di,uniq_token:C,visit_token:G,micro_session_id:ve,micro_session_count:Se,shop_id:Pe,theme_id:Ie,theme_city_hash:A,content_language:we,referer:Ae,checkout_one:!0,error_reason:hi}};if(!Y){g.notify(new Error("Event is required"),{metadata:{request:{monorail:{schemaId:Be,payload:JSON.stringify(xe)}}}});return}await qr(xe)}var b=(e=>(e.BuyItNow="BuyItNow",e.MoreOptions="MoreOptions",e.ApplePay="ApplePay",e.PayPal="PayPal",e.Venmo="Venmo",e.GooglePay="GooglePay",e.ShopPay="ShopifyPay",e.MetaPay="FacebookPay",e.BuyWithPrime="BuyWithPrime",e.AmazonPay="AmazonPay",e))(b||{}),T=(e=>(e.CartInitCalled="portable_wallets_cart_init_called",e.ClickSheetCancelled="portable_wallets_instrument_click_sheet_cancelled",e.ClickSheetFailed="portable_wallets_instrument_click_sheet_failure",e.ClickSheetSuccess="portable_wallets_instrument_click_sheet_success",e.AuthorizationAttempt="portable_wallets_authorization_attempt",e.AuthorizationComplete="portable_wallets_authorization_complete",e.InitCalled="portable_wallets_init_called",e.InitFailed="portable_wallets_init_failed",e.InitSuccess="portable_wallets_init_success",e.UpdateFailed="portable_wallets_instrument_update_failed",e.InstrumentLoaded="portable_wallets_instrument_loaded",e))(T||{});function Hr(e){const t=n=>{n.persisted&&(e(),window.removeEventListener("pageshow",t))};window.addEventListener("pageshow",t)}class Vr extends Error{constructor(t){super("[".concat(t.name,"] ").concat(t.message)),this.stack=t.stack,this.name="HandleCreateCartError"}}async function j({element:e,instrumentName:t,dataSource:n,willHandleErrorCodes:r,isShopPayRequest:a}){try{const i=await n.getCart({isShopPayRequest:a}),{cart:o,errors:s}=i;if(Hr(()=>{e&&(e.disabled=!1)}),!o||!o.id)throw new Error("[".concat(t,"] received invalid cart"));if(!o.checkoutUrl)throw new Error("[".concat(t,"] Created cart with no checkout URL"));if(s.length>0&&!(r!=null&&r(s)))throw new Error("Failed to create cart: ".concat(JSON.stringify(s)));const l=s.length===1&&s[0]===w.InvalidQuantity&&o.lineItems.every(c=>c.quantity===0);return E(f({},i),{outOfStock:l})}catch(i){throw new Vr(i)}finally{e.disabled=!1}}class Wr extends W{constructor(){super(...arguments),u(this,"anchor")}static get observedAttributes(){return["disabled"]}async connectedCallback(){this.render()}attributeChangedCallback(t,n,r){super.attributeChangedCallback(t,n,r,this.anchor)}async handleClick(t){if(t.preventDefault(),this.disabled||!this.anchor||this.anchor.getAttribute("disabled"))return;this.disabled=!0;const[n,r]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:a,cart:i}=await j({element:this,instrumentName:b.MoreOptions,dataSource:r,willHandleErrorCodes(o){return o.length===1&&o[0]===w.InvalidQuantity}});if(a){$(n.translate("error_dialogs.checkout.title"),n.translate("error_dialogs.product.out_of_stock"));return}ot(i.checkoutUrl)}catch(a){g.notify(a),$(n.translate("error_dialogs.checkout.title"),n.translate("error_dialogs.checkout.generic_error"))}}async render(){const t=await this.i18n,n=await this.classNames;this.anchor=kr(),this.anchor.textContent=t.translate("more_payment_options"),this.anchor.className=n,this.anchor.setAttribute("id","more-payment-options-link"),this.disabled&&this.anchor.setAttribute("disabled","true"),this.anchor.onclick=a=>this.handleClick(a),this.appendChild(this.anchor);const r=document.createElement("style");r.textContent=Lr,this.appendChild(r)}}class cn extends HTMLElement{constructor(){super(),u(this,"i18n"),u(this,"apiClient"),u(this,"setI18n"),u(this,"setApiClient"),[this.i18n,this.setI18n]=Z(),[this.apiClient,this.setApiClient]=Z()}}const jr="#buyer-consent{margin-top:1em}#buyer-consent-button{background:none;border:none;padding:0;text-decoration:underline;font-size:inherit;cursor:pointer}#buyer-consent-button:before{box-shadow:none}";class un extends cn{connectedCallback(){this.innerHTML="",this.render()}async render(){const t=await this.i18n,n=await this.apiClient,r=document.createElement("p");r.setAttribute("id","buyer-consent");const a=document.createElement("buyer-consent-button");a.setI18n(t),a.setApiClient(n),r.innerHTML=t.translate("subscriptions.buyer_consent",{subscriptionPolicyLink:'<span id="subscription-policy-button"></span>'}),r.querySelector("#subscription-policy-button").appendChild(a);const i=document.createElement("style");i.textContent=jr;const o=new DocumentFragment;o.appendChild(i),o.appendChild(r),this.appendChild(o)}}class Kr extends cn{constructor(){super(...arguments),u(this,"isFetchingPolicy",!1),u(this,"policy")}connectedCallback(){this.render()}async render(){const t=await this.i18n,n=Ft();n.setAttribute("id","buyer-consent-button"),n.textContent=t.translate("subscriptions.cancellation_policy"),n.onclick=this.onClick.bind(this),this.appendChild(n)}async onClick(t){t.preventDefault();const n=await this.i18n,r=await this.apiClient;if(!this.isFetchingPolicy){if(this.policy){this.showPolicy(this.policy,n);return}try{await this.fetchSubscriptionPolicy(r);const a=this.policy&&this.policy!==""?this.policy:n.translate("subscriptions.policy_not_found");this.showPolicy(a,n)}catch(a){g.notify(a),this.showPolicy(n.translate("subscriptions.policy_not_found"),n)}}}async fetchSubscriptionPolicy(t){this.isFetchingPolicy=!0,this.policy=await t.fetchSubscriptionPolicy(),this.isFetchingPolicy=!1}showPolicy(t,n){Tr(n.translate("subscriptions.subscription_policy"),t)}}F("buyer-consent-button",Kr,{isChildCustomElement:!0}),F("buyer-consent",un);class Gr extends Error{constructor({code:t,message:n}){super(n),u(this,"name","DeveloperError"),u(this,"code","unknown"),this.code=t}}class Yr extends Error{constructor({message:t}){super(t),u(this,"name","SilencedError")}}class Qr extends Error{constructor(){super(...arguments),u(this,"name","MissingConfigError")}}var D=(e=>(e.ButtonDisplay="buttonDisplay",e.LoadInstrument="loadInstrument",e.LoadSdk="loadSDK",e.AuthorizationLatency="authorizationLatency",e))(D||{});function dn(){var e,t;return!!((e=window.performance)!=null&&e.mark)&&!!((t=window.performance)!=null&&t.measure)}function Mt(e,t){return Bt(e,t),()=>rt(e,t)}function Bt(e,t){dn()&&window.performance.mark("".concat(e,"-").concat(t,"-start"))}function rt(e,t){var n,r;if(dn())try{const a="".concat(e,"-").concat(t,"-start"),i="".concat(e,"-").concat(t,"-end"),o="".concat(e,"-").concat(t,"-duration");window.performance.mark(i);const s=(r=window.performance.measure(o,a,i))!=null?r:(n=window.performance.getEntriesByName(o,"measure"))==null?void 0:n[0],l=s==null?void 0:s.duration;if(l==null){g.notify(new Error("Could not measure performance of ".concat(e," ").concat(t)),{severity:"warning"});return}return l}catch(a){g.notify(a);return}}function Jr(){N({event:T.InitCalled})}function Zr({result:e,eventType:t}){var n,r;_.counter({name:R.InitCompleted,value:1,attributes:{result:e,eventType:t,recoveredFailure:!!((r=(n=window.Shopify)==null?void 0:n.PaymentButton)!=null&&r.failedToLoad)}}),N({event:e==="success"?T.InitSuccess:T.InitFailed,eventSubtype:t})}function Xr({instrument:e,measurement:t}){t!=null&&_.histogram({name:R.InstrumentLoadTime,value:t,attributes:{instrument:e},unit:"ms"}),N({event:T.InstrumentLoaded,instrumentId:e,ttl:t})}function ta({instrument:e,measurement:t,result:n}){t!=null&&_.histogram({name:V.InstrumentSdkLoaded,value:t,attributes:{instrument:e,result:n},unit:"ms"});const r=n==="success"?V.InstrumentSdkLoaded:V.InstrumentSdkFailed;N({event:r,instrumentId:e,ttl:t,errorReason:n==="success"?void 0:n})}function ea({instrument:e,result:t,reason:n}){_.counter({name:V.InstrumentSdkEligible,value:1,attributes:{instrument:e,reason:n,result:t}});const r=t==="success"?V.InstrumentSdkEligible:V.InstrumentSdkNotEligible;N({event:r,instrumentId:e})}function na({instrument:e,reason:t}){_.counter({name:R.InstrumentLoadNotEligible,value:1,attributes:{instrument:e,reason:t}})}function ra({instrument:e,result:t,checkoutToken:n}){_.counter({name:R.SheetClicked,value:1,attributes:{instrument:e,result:t}}),N({event:t==="success"?T.ClickSheetSuccess:T.ClickSheetFailed,checkoutToken:n,instrumentId:e})}function aa(e,t){N({event:"".concat(T.UpdateFailed,"-").concat(t),instrumentId:e})}function oa(e){_.counter({name:R.SheetCancelled,value:1,attributes:{instrument:e}}),N({event:T.ClickSheetCancelled,instrumentId:e})}function ia(e){_.counter({name:R.AuthorizationAttempt,value:1,attributes:{instrument:e}}),N({event:T.AuthorizationAttempt,instrumentId:e})}function sa({instrument:e,measurement:t,result:n}){t!=null&&_.histogram({name:R.AuthorizationComplete,value:t,attributes:{instrument:e,result:n},unit:"ms"}),N({event:T.AuthorizationComplete,eventSubtype:n,ttl:t,instrumentId:e})}function la({instrument:e,reason:t}){_.counter({name:R.Decelerated,value:1,attributes:{instrument:e,reason:t}}),_.exportMetrics()}function ca({reason:e}){_.counter({name:R.CartTokenMissing,value:1,attributes:{reason:e}})}function ua(){window.setInterval(()=>{_.exportMetrics()},1e3)}const m={initStarted:P(Jr),initCompleted:P(Zr),instrumentLoaded:P(Xr),instrumentLoadNotEligible:P(na),instrumentSDKLoaded:P(ta),instrumentSDKEligible:P(ea),sheetClicked:P(ra),updateFailed:P(aa),sheetCancelled:P(oa),authorizationAttempt:P(ia),authorizationComplete:P(sa),startExporter:P(ua),decelerated:P(la),cartTokenMissing:P(ca)};function P(e){return(...t)=>{try{e(...t)}catch(n){g.notify(n)}}}function de(e,t,n){if(mt!=null&&mt.length){const r=mt.join(",");e.querySelectorAll(r).forEach(a=>{n===null?a.removeAttribute(t):a.setAttribute(t,n)})}}function da(e,t){try{const n=JSON.parse(e!=null?e:"[]");if(!(n instanceof Array))throw new Error("[".concat(t,"] invalid walletConfigs found"));return n}catch(n){throw new Error("[".concat(t,"] Error while parsing walletConfigs JSON: ").concat(n))}}function ha(e,t){try{return e?JSON.parse(e):null}catch(n){throw new Error("[".concat(t,"] Error while parsing walletConfig JSON: ").concat(n))}}function he(e){var t;const n=e==null?void 0:e.getLoadEligibility();return n!=null&&n.eligible||m.instrumentLoadNotEligible({instrument:e==null?void 0:e.getInstrumentName(),reason:n==null?void 0:n.reason}),(t=n==null?void 0:n.eligible)!=null?t:!1}function pa(e){return e.filter(he)}async function Xt({walletInstrument:e,instanceNumber:t}){const n=e.getInstrumentName(),r=Mt(D.LoadSdk,"".concat(n,":").concat(t));try{await e.loadWalletSDK(),m.instrumentSDKLoaded({instrument:n,measurement:r(),result:"success"})}catch(i){return g.notify(i),m.instrumentSDKLoaded({instrument:n,measurement:r(),result:"failed"}),null}const a=e.getPartnerSDKEligibility();return a.eligible?(m.instrumentSDKEligible({instrument:n,result:"success"}),e):(m.instrumentSDKEligible({instrument:n,reason:a.reason,result:"failed"}),null)}class pe extends ln{constructor(){super(...arguments),u(this,"apiClient"),u(this,"i18n")}get shopId(){return this.getAttribute("shop-id")}get cartId(){return this.getAttribute("cart-id")}get walletConfigs(){return this.getAttribute("wallet-configs")}get recommendedWallet(){return this.getAttribute("recommended")}get fallbackWallet(){return this.getAttribute("fallback")}get variantParams(){var t;try{return JSON.parse((t=this.getAttribute("variant-params"))!=null?t:"[]")}catch(n){throw new Gr({code:"invalid-variant-params",message:"variant-params must be a valid JSON string"})}}triggerLoadedEvent(){document.dispatchEvent(new Event("shopify:payment_button:loaded",{bubbles:!0,cancelable:!0}))}async attributeChangedCallback(t,n,r){n!==r&&de(this,t,r)}toggleBuyerConsent(t,n,r){if(this.hasSellingPlan){const i=document.createElement("buyer-consent");i.setI18n(r),i.setApiClient(n),t.appendChild(i);return}const a=document.querySelector("buyer-consent");a&&t.contains(a)&&a.remove()}}F("buyer-consent",un,{isChildCustomElement:!0});const dt=Element.prototype;function hn(e){const t=me(e);return pn(t)}function pn(e){var t;const n=e==null?void 0:e.elements;if(!n)return null;const r=_t(n,"id");if(!r||isNaN(Number(r)))return null;const a=Number((t=_t(n,"quantity"))!=null?t:"1"),i="gid://shopify/ProductVariant/".concat(r),o=_t(n,"selling_plan"),s=o?"gid://shopify/SellingPlan/".concat(o):void 0,l=ya(e);return{variantId:r,quantity:a,merchandiseId:i,sellingPlanId:s,lineItemProperties:l}}function me(e){const t=Ue(e,"[data-shopify='payment-button']")||document.querySelector("[data-shopify='payment-button']");return Ue(t,"form")}function ma(e){const t=e==null?void 0:e.elements;return t?!!_t(t,"selling_plan"):!1}function ya(e){if(!e)return{};const t=document.querySelectorAll('[name^="properties"][form^="'.concat(CSS.escape(e.getAttribute("id")||""),'"]')),n=e.querySelectorAll('[name^="properties"]'),r=[...t,...n],a={};return r.forEach(i=>{const o=fa(i),s=ga(i);o&&typeof s<"u"&&(a[o]=s)}),a}function fa(e){const t=e.getAttribute("name");if(t===null)return null;const n=t.indexOf("["),r=t.lastIndexOf("]");return n===-1||r===-1?null:t.substring(n+1,r)}function ga(e){if(!(["radio","checkbox"].includes(e.type)&&!e.checked)&&!(e.value===""||typeof e.value>"u"))return e.value}function _t(e,t){var n;const r=e.namedItem(t);return r&&"value"in r&&(n=r.value)!=null?n:null}function Ue(e,t){if(dt.matches=dt.matches||dt.webkitMatchesSelector||dt.msMatchesSelector||dt.mozMatchesSelector,!e||e.matches(t))return e;let n=e;for(;n&&n!==document.body;)if(n=n.parentElement,n&&n.matches(t))return n;return null}class ba{constructor(t,n){u(this,"addToCartMutationObserver"),u(this,"addToCartForm"),u(this,"addToCartButtons"),this.element=t,this.onFormChanged=n,this.addToCartMutationObserver=null,this.addToCartForm=null,this.addToCartButtons=[]}setupMutationObservers(){if(this.findAndSetAddToCartButtons(),!this.addToCartForm)return;this.syncComponentStateWithForm();const t=new MutationObserver(()=>this.reobserveOnFormChanges());this.addToCartMutationObserver=new MutationObserver(()=>this.syncComponentStateWithForm()),t.observe(this.addToCartForm,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),this.observeAddToCartButtons()}syncComponentStateWithForm(){if(!this.addToCartForm){this.onFormChanged({disabled:!0,hasSellingPlan:!1});return}const t=pn(this.addToCartForm),n=!!(this.addToCartButtons.length>0&&this.addToCartButtons.every(r=>r.disabled));this.onFormChanged({disabled:n||t===null,hasSellingPlan:ma(this.addToCartForm)})}observeAddToCartButtons(){this.addToCartButtons.forEach(t=>{this.addToCartMutationObserver.observe(t,{attributes:!0})})}reobserveOnFormChanges(){var t;(t=this.addToCartMutationObserver)==null||t.disconnect(),this.findAndSetAddToCartButtons(),this.observeAddToCartButtons(),this.syncComponentStateWithForm()}findAndSetAddToCartButtons(){this.addToCartForm=me(this.element),this.addToCartForm&&(this.addToCartButtons=[...this.addToCartForm.querySelectorAll("[type=submit]")])}}function wa(e,t,n){try{const r=JSON.parse(e!=null?e:"{}"),a=JSON.parse(t!=null?t:JSON.stringify({name:"buy_it_now",wallet_params:{}}));if(r===null||Object.keys(r).length===0){if(!(a instanceof Object))throw new Error("[".concat(n,"] Invalid fallback wallet configs JSON"));return{recommendedWallet:null,fallbackWallet:a}}return{recommendedWallet:r,fallbackWallet:a}}catch(r){throw new Error("[".concat(n,"] Error while parsing recommended/fallback JSON: ").concat(r))}}class Ca extends W{constructor(){super(...arguments),u(this,"button",null),u(this,"buyNowText","")}static get observedAttributes(){return["disabled"]}async connectedCallback(){this.buyNowText=(await this.i18n).translate("instruments_copy.checkout.buy_now"),this.render()}attributeChangedCallback(t,n,r){super.attributeChangedCallback(t,n,r,this.button)}async handleClick(){if(this.disabled||!this.button||this.button.getAttribute("aria-disabled"))return;this.disabled=!0;const[t,n]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:r,cart:a}=await j({element:this,instrumentName:b.BuyItNow,dataSource:n,willHandleErrorCodes(i){return i.length===1&&i[0]===w.InvalidQuantity}});if(m.sheetClicked({instrument:b.BuyItNow,checkoutToken:$t(a),result:"success"}),r){$(t.translate("error_dialogs.checkout.title"),t.translate("error_dialogs.product.out_of_stock"));return}ot(a.checkoutUrl)}catch(r){g.notify(r),m.sheetClicked({instrument:b.BuyItNow,result:"failed"}),$(t.translate("error_dialogs.checkout.title"),t.translate("error_dialogs.checkout.generic_error"))}}async render(){var t;this.button||(this.button=Ft());const n=await this.classNames;this.button.textContent=this.buyNowText,this.button.className=n,this.disabled&&this.button.setAttribute("aria-disabled","true"),this.button.onclick=()=>this.handleClick(),this.appendChild(this.button),(t=this.onRendered)==null||t.call(this)}}function va(){const e=navigator.userAgent,t=e.indexOf("Android")>-1,n=e.indexOf("Chrome/")>-1,r=parseInt((/Chrome\/([0-9]+)/.exec(e)||["0","0"])[1],10);return t&&n&&r===114}class K{constructor(t){u(this,"walletParams"),this.walletParams=t.wallet_params}static walletName(){throw new Error("Must define walletName for WalletInstrument subclass")}createWebComponent({walletContainer:t,dataSource:n,i18n:r,apiClient:a,classNames:i="",callToAction:o,pageType:s=k.ProductPage,onRendered:l=()=>{}}){var c,d,h;const y=this.getWebComponentName();F(y,this.getWebComponentClass(),{isChildCustomElement:!0});const p=document.createElement(y),v={"access-token":(c=t.accessToken)!=null?c:"","buyer-country":(d=t.buyerCountry)!=null?d:"","buyer-currency":t.buyerCurrency,disabled:String(t.disabled),"wallet-params":JSON.stringify((h=this.walletParams)!=null?h:{}),"page-type":s};try{nt(p,v),t.isShippingRequired&&p.setAttribute("requires-shipping",""),t.hasSellingPlan&&p.setAttribute("has-selling-plan","")}catch(C){const G=C;throw G.message.includes("setAttribute is not a function")&&va()?new Yr({message:G.message}):G}return o&&p.setAttribute("call-to-action",""),p.setDataSource(n),p.setApiClient(a),p.setI18n(r),p.setClassNames(i),p.onRendered=l,p}loadWalletSDK(){return Promise.resolve()}getLoadEligibility(){return{eligible:!0}}getPartnerSDKEligibility(){return{eligible:!0}}}class Aa extends K{static walletName(){return"buy_it_now"}getWebComponentName(){return"shopify-buy-it-now-button"}getInstrumentName(){return b.BuyItNow}getWebComponentClass(){return Ca}}const Ea="shopify-paypal-button[disabled=true]{opacity:.5;cursor:not-allowed;pointer-events:none}";async function Pt(e){const{cartClient:t,instrumentName:n}=e;try{if(!e.cartId)throw new Error("[".concat(n,"] provided no cart ID when updating buyer identity"));if(!t)throw new Error("[".concat(n,"] provided invalid cart client when updating buyer identity"));return await t.updateCartBuyerIdentity(e)}catch(r){throw m.updateFailed(n,"updateBuyerIdentity"),r}}async function mn({cartId:e,totalAmount:t,paymentMethod:n,billingAddress:r,cartClient:a,instrumentName:i,abortSignal:o,hasSellingPlan:s}){try{if(!e)throw new Error("[".concat(i,"] provided no cart ID when updating payment"));if(!t)throw new Error("[".concat(i,"] provided no total amount when updating payment"));if(!n)throw new Error("[".concat(i,"] provided no apple pay wallet content when updating payment"));if(!a)throw new Error("[".concat(i,"] provided invalid cart client when updating payment"));const l={freePaymentMethod:{billingAddress:r}};return await a.updateCartPayment(e,f({amount:{amount:t.amount,currencyCode:t.currencyCode}},Number(t.amount)<=0&&!s?l:n),o)}catch(l){throw m.updateFailed(i,"updatePayment"),l}}class Sa extends W{constructor(){super(),u(this,"name",b.PayPal),u(this,"abortController"),u(this,"cartId"),u(this,"sdkButtonsComponent"),u(this,"container",null),u(this,"measurementContainer",null),u(this,"resizeObserver",null),u(this,"buttonHeight"),u(this,"rendering",!1),this.abortController=typeof AbortController=="function"&&new AbortController||null,this.resizeObserver=typeof ResizeObserver=="function"&&new ResizeObserver(t=>this.onResize(t))||null}async connectedCallback(){this.render()}disconnectedCallback(){this.sdkButtonsComponent&&this.sdkButtonsComponent.close(),this.resizeObserver&&this.resizeObserver.disconnect()}async onResize(t){var n,r,a;this.measurementContainer&&this.getPayPalConstrainedHeight((r=(n=t[0])==null?void 0:n.contentRect)==null?void 0:r.height)!==this.buttonHeight&&!this.rendering&&(await((a=this.sdkButtonsComponent)==null?void 0:a.close()),this.container.innerHTML="",this.sdkButtonsComponent=void 0,await this.renderFromPayPalSDK())}async render(){var t;const n=document.createElement("style");n.innerHTML=Ea;const r=document.createElement("div"),a=document.createElement("div"),i=await this.classNames;r.className=i,a.className=i,nt(r,{role:"button"}),nt(a,{role:"button","aria-hidden":"true",tabindex:"-1"}),a.innerHTML="&nbsp;",ft(r,{display:"flex",overflow:"hidden","max-height":"55px"}),ft(a,{display:"block",opacity:"0",visibility:"hidden","pointer-events":"none",position:"absolute","max-height":"55px"}),this.appendChild(a),this.appendChild(n),this.appendChild(r),this.container=r,this.measurementContainer=a,this.renderFromPayPalSDK(),(t=this.resizeObserver)==null||t.observe(this.measurementContainer)}async renderFromPayPalSDK(){var t,n,r;if(!this.container)throw new Error("button container not set when attempting to render");this.rendering=!0;const a=this.walletParams.paymentIntent==="TOKENIZE",i=()=>this.createToken(this.apiClient,this.dataSource);let o,s;a?s=i:o=i;const l=async(h,y)=>this.disabled?y.reject():y.resolve(),c=await this.i18n,d=this.getPayPalConstrainedHeight(this.getContainerHeight());this.sdkButtonsComponent=(n=(t=window.paypal).Buttons)==null?void 0:n.call(t,{fundingSource:"paypal",style:{color:"gold",label:this.hasAttribute("call-to-action")?"pay":"paypal",height:d,shape:"sharp"},createOrder:o,createBillingAgreement:s,onApprove:async h=>{await this.onApprove(h)},onCancel:()=>{var h;m.sheetCancelled(this.name),(h=this.abortController)==null||h.abort()},onClick:l,onError:h=>{var y;if(h.message==="Window is closed, can not determine type"){m.sheetCancelled(this.name),(y=this.abortController)==null||y.abort();return}g.notify(h),$(c.translate("error_dialogs.checkout.title"),c.translate("error_dialogs.checkout.generic_error"))}}),await((r=this.sdkButtonsComponent)==null?void 0:r.render(this.container)),this.rendering=!1,this.onRendered()}async createToken(t,n){const r=await t,a=await n;try{const{cart:i}=await j({element:this,instrumentName:this.name,dataSource:a}),o=await r.paypalTokenCreate(i.id);return this.cartId=i.id,o}finally{m.sheetClicked({instrument:this.name,result:this.cartId?"success":"failed"})}}async onApprove({orderID:t,payerID:n}){var r,a,i;try{if(m.authorizationAttempt(this.name),Bt(D.AuthorizationLatency,this.name),!this.cartId)throw new Error("Cart not found");const o=await this.apiClient,s=await o.paypalBuyerDetailsFetch(t),{data:l}=await Pt({cartId:this.cartId,cartClient:o,instrumentName:this.name,emailAddress:s.email,streetAddress:s.destinationAddress});if(!l)throw new Error("Cart not found");await mn({abortSignal:(r=this.abortController)==null?void 0:r.signal,cartClient:o,cartId:l.id,instrumentName:b.PayPal,billingAddress:(a=s.billingAddress)!=null?a:s.destinationAddress,paymentMethod:{walletPaymentMethod:{paypalWalletContent:{billingAddress:(i=s.billingAddress)!=null?i:s.destinationAddress,email:s.email,expiresAt:s.expiresAt,payerId:n,token:t,acceptedSubscriptionTerms:!1,vaultingAgreement:!1}}},totalAmount:l.totalAmount}),m.authorizationComplete({instrument:this.name,result:"success",measurement:rt(D.AuthorizationLatency,this.name)}),ot(l.checkoutUrl)}catch(o){throw m.authorizationComplete({instrument:this.name,result:"failure",measurement:rt(D.AuthorizationLatency,this.name)}),o}}getPayPalConstrainedHeight(t){if(t)return Math.min(55,Math.max(t,25))}getContainerHeight(){if(!this.measurementContainer)return this.buttonHeight;const t=this.measurementContainer.getBoundingClientRect().height;return this.buttonHeight=t,t}}class _a extends K{static walletName(){return"paypal"}constructor(t){super(t)}getWebComponentName(){return"shopify-paypal-button"}getInstrumentName(){return b.PayPal}getWebComponentClass(){return Sa}loadWalletSDK(){const t=document.createElement("script");return t.setAttribute("src",this.walletParams.sdkUrl),new Promise((n,r)=>{t.onload=()=>n(),t.onerror=a=>{document.body.removeChild(t),r(a)},document.body.appendChild(t)})}getLoadEligibility(){return{eligible:!0}}getPartnerSDKEligibility(){var t,n;return(n=(t=window==null?void 0:window.paypal)==null?void 0:t.Buttons)!=null&&n.call(t).isEligible()?{eligible:!0}:{eligible:!1,reason:"failed PayPal SDK eligibility check"}}}const Pa=".apple-pay-button{display:flex;align-items:center;justify-content:center;width:100%;padding:0!important;cursor:pointer;border:none}.apple-pay-button:hover:not(:disabled){filter:brightness(92%)}.apple-pay-button svg{height:100%;flex-shrink:0}.apple-pay--content{width:100%;height:100%;flex-grow:1;display:flex;align-items:center;justify-content:center;white-space:pre}.apple-pay--light{background:#fff;color:#000}.apple-pay--light svg{fill:#000}.apple-pay--dark{background:#000;color:#fff}.apple-pay--dark svg{fill:#fff}",te={UK:"GB",JA:"JP"},yn=["AS","GU","MP","PR","VI"];yn.forEach(e=>{te[e]="US"});function At(e){var t,n;const r=e.countryCode,a={firstName:e.givenName||void 0,lastName:e.familyName||void 0,address1:(t=e==null?void 0:e.addressLines)==null?void 0:t[0],address2:((n=e==null?void 0:e.addressLines)==null?void 0:n[1])||void 0,city:e.locality||void 0,zip:e.postalCode||void 0,province:e.administrativeArea||e.subLocality||void 0,country:Ia(e.countryCode),phone:e.phoneNumber||void 0};return a.country==="HK"&&(a.zip=void 0,a.province=e.postalCode),r&&yn.includes(r)&&(a.province=r),a.lastName||(a.lastName=a.firstName),a}function Ia(e){if(!e)return"ZZ";const t=e.toUpperCase();return Object.keys(te).includes(t)?te[t]:t}function ka(e,t){return X({label:e,possibleLines:[t]})[0]}function Ta({subtotal:e,deliveryGroups:t,duties:n,taxes:r,discountAllocations:a,i18n:i,formattedRecurringTotals:o}){var s;const l=X({label:i.translate("order_summary.subtotal"),possibleLines:[e]}),c=Da(t,i),d=X({label:i.translate("order_summary.duties"),possibleLines:[n]}),h=X({label:i.translate("order_summary.taxes"),possibleLines:[r]}),y=o.map(C=>({label:C,amount:"0.00",type:"pending"})),p=y.length?[{label:i.translate("order_summary.subscriptions.recurring_total_tooltip_line"),amount:"0.00",type:"pending"}]:[],v=(s=a==null?void 0:a.flatMap(C=>{var G;const ve=(G=C.title)!=null?G:C.code;return X({label:ve!=null?ve:i.translate("order_summary.discount"),possibleLines:[C.discountedAmount],isDiscount:!0})}))!=null?s:[];return[...l,...c,...d,...h,...v,...y,...p]}function X({label:e,possibleLines:t,isDiscount:n=!1}){return t.filter(r=>(r==null?void 0:r.amount)!==void 0).map(r=>({label:e,amount:n?"-".concat(Jt(r.amount)):Jt(r.amount)}))}function Da(e,t){return e.some(n=>n.groupType===bt.Subscription)?e.map(n=>({label:n.groupType===bt.Subscription?t.translate("order_summary.shipping_subscription"):t.translate("order_summary.shipping_one_time_purchase"),amount:Jt(n.selectedDeliveryOption.estimatedCost.amount)})):X({label:t.translate("order_summary.shipping"),possibleLines:e.map(n=>{var r;return{amount:(r=n.selectedDeliveryOption)==null?void 0:r.estimatedCost.amount}})})}function Na(e,t){return e.map(n=>{var r;return{title:La(n,t),estimatedCost:{amount:Ra(n),currencyCode:n[0].estimatedCost.currencyCode},handle:Oa(n),description:(r=n[0].description)!=null?r:""}})}function xa(e){return e.map(t=>t.deliveryOptions.map(n=>E(f({},n),{groupType:t.groupType}))).reduce((t,n)=>t.flatMap(r=>n.map(a=>[...r,a])),[[]])}function Ra(e){return e.reduce((t,n)=>t+Number(n.estimatedCost.amount),0).toFixed(2)}function La(e,t){var n,r;const a=(n=e.find(s=>s.groupType===bt.OneTimePurchase))==null?void 0:n.title,i=(r=e.find(s=>s.groupType===bt.Subscription))==null?void 0:r.title,o=[...new Set([a,i])].filter(Boolean);return o.length===2?t.translate("shipping_methods.connect_shipping_methods",{methodOne:o[0],methodTwo:o[1]}):o[0]}function Oa(e){return e.map(t=>t.handle).join(",")}function $a(e,t){if(!e.length)return[];const n=xa(e);return Na(n,t).map(r=>{var a;return{label:r.title||"",amount:r.estimatedCost.amount,identifier:r.handle,detail:(a=r.description)!=null?a:""}})}const Wt=async({paymentSheetAction:e,onProceed:t,terminateSession:n})=>{switch(e.action){case"abort":n();break;case"show_error":await t(e.errors);break;case"update":await t(e.errors);break;default:throw new Error('Missing handler for payment sheet action "'.concat(e.action,'"'))}},Fa=["abort","show_error","complete","update"];class Ma{constructor(){u(this,"generatePrioritizedPaymentSheetAction",(t,n)=>{let r;const a=[],i=[],o=[],s=n.filter(c=>c!==w.UnacceptablePaymentsAmount).some(c=>t[c]!==void 0);for(const c of Object.keys(t))if(!(c===w.UnacceptablePaymentsAmount&&s)){const d=t[c]();d.effects&&i.push(...d.effects),d.action!=="complete"&&d.errors&&o.push(...d.errors),a.push(d)}const l=(c=>Fa.map(d=>c.find(h=>h.action===d)).find(d=>!!d))(a);return l&&(r=l,r.effects=i,r.action!=="complete"&&(r.errors=o)),r})}getMergedPaymentSheetAction({result:t,errorActions:n}){const r={};n.forEach(i=>{i.errors.forEach(o=>{t.errors.includes(o)&&(r[o]=i.generateAction)})});let a;for(const i of t.errors){const o=r[i];if(o){a=o();break}}return{firstPaymentSheetAction:a,prioritizedPaymentSheetAction:this.generatePrioritizedPaymentSheetAction(r,t.errors)}}getUnhandledErrors(t,n){const r=n.flatMap(a=>a.errors);return t.filter(a=>!r.includes(a))}}class Ba extends Ma{constructor(t){super(),this.i18n=t}mapMutationResultToPaymentSheetAction(t,n){var r;const a=this.getErrorActions();if(this.getUnhandledErrors(t.errors,a).forEach(o=>{g.notify(new Error("[".concat(b.ApplePay,"] mutation result error not handled: ").concat(o)))}),((r=t.data)==null?void 0:r.deliveryGroups.length)===0&&n!=null&&n.shippingRequired)return{action:"show_error",errors:[new ApplePayError("addressUnserviceable")]};const{firstPaymentSheetAction:i}=this.getMergedPaymentSheetAction({result:t,errorActions:a});return i||{action:"update",errors:[]}}mapCompletionResultToPaymentSheetAction(t){if(!t.data)throw new Error("[".concat(b.ApplePay,"] completion returned null result"));switch(t.data.__typename){case"SubmitSuccess":return{action:"complete",redirectUrl:t.data.redirectUrl};case"SubmitAlreadyAccepted":case"SubmitThrottled":case"SubmitFailed":{const n=this.getErrorActions();this.getUnhandledErrors(t.errors,n).forEach(a=>{g.notify(new Error("[".concat(b.ApplePay,"] completion result error not handled: ").concat(a)))});const{prioritizedPaymentSheetAction:r}=this.getMergedPaymentSheetAction({result:t,errorActions:n});return r||{action:"abort"}}default:throw new Error("[".concat(b.ApplePay,"] unknown completion result type: ").concat(t.data.__typename))}}getErrorActions(){return[{errors:[w.InvalidLanguage],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(b.ApplePay,"] mutation provided invalid language, aborting")))}]})},{errors:[w.InvalidCountry],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(b.ApplePay,"] mutation provided invalid country, aborting")))}]})},{errors:[w.MissingCartId],generateAction:()=>({action:"abort",effects:[()=>{g.notify(new Error("[".concat(b.ApplePay,"] mutation provided invalid cart ID, aborting")))}]})},{errors:[w.UnacceptablePaymentsAmount],generateAction:()=>({action:"abort"})},{errors:[w.InvalidPaymentAmount],generateAction:()=>({action:"abort"})},{errors:[w.MerchandiseOutOfStock],generateAction:()=>({action:"abort"})},{errors:[w.DeliveryNotAvailable],generateAction:()=>({action:"show_error",errors:[new ApplePayError("addressUnserviceable")]})},{errors:[w.BuyerIdentityEmailRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","emailAddress",this.i18n.translate("errors.missing.email"))]})},{errors:[w.DeliveryFirstNameRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.first_name"))]})},{errors:[w.DeliveryFirstNameInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.first_name"))]})},{errors:[w.DeliveryLastNameRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.last_name"))]})},{errors:[w.DeliveryLastNameInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.last_name"))]})},{errors:[w.DeliveryAddress1Required],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address1"))]})},{errors:[w.DeliveryAddress1Invalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address1"))]})},{errors:[w.DeliveryAddress2Required],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address2"))]})},{errors:[w.DeliveryAddress2Invalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address2"))]})},{errors:[w.DeliveryCityRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.missing.city"))]})},{errors:[w.DeliveryCityInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.invalid.city"))]})},{errors:[w.DeliveryZoneRequiredForCountry],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","administrativeArea",this.i18n.translate("errors.missing.zone"))]})},{errors:[w.DeliveryZoneNotFound],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","administrativeArea",this.i18n.translate("errors.invalid.zone"))]})},{errors:[w.DeliveryPostalCodeRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.missing.postal_code"))]})},{errors:[w.DeliveryPostalCodeInvalid,w.DeliveryInvalidPostalCodeForZone,w.DeliveryInvalidPostalCodeForCountry],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.invalid.postal_code"))]})},{errors:[w.DeliveryPhoneNumberRequired],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.missing.phone"))]})},{errors:[w.DeliveryPhoneNumberInvalid,w.BuyerIdentityInvalidPhone],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.invalid.phone"))]})},{errors:[w.BuyerIdentityInvalidCountry,w.DeliveryCountryInvalid],generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","country",this.i18n.translate("errors.invalid.country"))]})}]}}const ze=["name","postalAddress"];function Ua({shippingRequired:e,walletParams:t,buyerCurrency:n}){const{phoneRequired:r,emailRequired:a}=t,i=[...a?["email"]:[],...r?["phone"]:[]],o=e?[...ze,...i]:i;return{countryCode:t.countryCode,currencyCode:n,merchantCapabilities:t.merchantCapabilities,supportedNetworks:t.supportedNetworks,total:{type:"pending",label:t.merchantName,amount:"1.00"},requiredBillingContactFields:ze,requiredShippingContactFields:o,shippingType:t.shippingType}}const za=e=>{const t=e.lineItems.reduce((n,r)=>n+Number(r.subtotalAmount.amount),0);return{amount:String(t),currencyCode:e.totalAmount.currencyCode}},qa=e=>{const t=e.lineItems.flatMap(n=>n.discountAllocations);return[...e.discountCodes.filter(n=>n.applicable&&e.discountAllocations.findIndex(r=>r.code===n.code)===-1&&t.findIndex(r=>r.code===n.code)===-1).map(n=>({code:n.code,discountedAmount:{amount:"0",currencyCode:e.totalAmount.currencyCode}})),...e.discountAllocations,...t]};function Ha(e,t){return e.reduce((n,r)=>{var a;if(!r.sellingPlanAllocation)return n;const{sellingPlanAllocation:{sellingPlan:i,priceAdjustments:o},quantity:s}=r;if(!i.recurringDeliveries||!i.billingPolicy)return n;const l=Va({billingPolicy:i.billingPolicy,i18n:t}),c=i.priceAdjustments[0].orderCount,d=o[0].price.currencyCode,h=qe({price:Number(o[0].price.amount)*s,currencyCode:d,locale:t.locale});if(o.length===2){const y=o[1].price.currencyCode,p=qe({price:Number((a=o[1])==null?void 0:a.price.amount)*s,currencyCode:y,locale:t.locale});return[...n,t.translate("order_summary.subscriptions.recurring_totals_with_policies",{count:c,fixedPrice:h,recurringPrice:p,interval:l})]}return[...n,t.translate("order_summary.subscriptions.recurring_totals",{fixedPrice:h,interval:l})]},[])}function qe({price:e,currencyCode:t,locale:n}){return Intl.NumberFormat(n,{style:"currency",currency:t,currencyDisplay:"narrowSymbol"}).format(e)}function Va({billingPolicy:e,i18n:t}){const{interval:n,intervalCount:r}=e,a={YEAR:"order_summary.subscriptions.recurring_total_intervals.year",MONTH:"order_summary.subscriptions.recurring_total_intervals.month",WEEK:"order_summary.subscriptions.recurring_total_intervals.week",DAY:"order_summary.subscriptions.recurring_total_intervals.day"}[n];if(!a)throw new Error("Unknown selling plan interval provided: ".concat(n));return t.translate(a,{count:r})}const Ut="GraphQL Client",He=0,Ve=3,fn="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",gn="Response returned unexpected Content-Type:",bn="An unknown error has occurred. The API did not return a data object or any errors in its response.",ee={json:"application/json",multipart:"multipart/mixed"},We="X-SDK-Variant",je="X-SDK-Version",Wa="shopify-graphql-client",ja="0.10.3",wn=1e3,Ka=[429,503],Cn=/@(defer)\b/i,Ke="\r\n",Ga=/boundary="?([^=";]+)"?/i,Ge=Ke+Ke;function H(e,t=Ut){return e.startsWith("".concat(t))?e:"".concat(t,": ").concat(e)}function it(e){return e instanceof Error?e.message:JSON.stringify(e)}function vn(e){return e instanceof Error&&e.cause?e.cause:void 0}function An(e){return e.flatMap(({errors:t})=>t!=null?t:[])}function En({client:e,retries:t}){if(t!==void 0&&(typeof t!="number"||t<He||t>Ve))throw new Error("".concat(e,': The provided "retries" value (').concat(t,") is invalid - it cannot be less than ").concat(He," or greater than ").concat(Ve))}function I(e,t){return t&&(typeof t!="object"||Array.isArray(t)||typeof t=="object"&&Object.keys(t).length>0)?{[e]:t}:{}}function Sn(e,t){if(e.length===0)return t;const n={[e.pop()]:t};return e.length===0?n:Sn(e,n)}function _n(e,t){return Object.keys(t||{}).reduce((n,r)=>(typeof t[r]=="object"||Array.isArray(t[r]))&&e[r]?(n[r]=_n(e[r],t[r]),n):(n[r]=t[r],n),Array.isArray(e)?[...e]:f({},e))}function Pn([e,...t]){return t.reduce(_n,f({},e))}function Ya({clientLogger:e,customFetchApi:t=fetch,client:n=Ut,defaultRetryWaitTime:r=wn,retriableCodes:a=Ka}){const i=async(o,s,l)=>{const c=s+1,d=l+1;let h;try{if(h=await t(...o),e({type:"HTTP-Response",content:{requestParams:o,response:h}}),!h.ok&&a.includes(h.status)&&c<=d)throw new Error;return h}catch(y){if(c<=d){const p=h==null?void 0:h.headers.get("Retry-After");return await Qa(p?parseInt(p,10):r),e({type:"HTTP-Retry",content:{requestParams:o,lastResponse:h,retryAttempt:s,maxRetries:l}}),i(o,c,l)}throw new Error(H("".concat(l>0?"Attempted maximum number of ".concat(l," network retries. Last message - "):"").concat(it(y)),n))}};return i}async function Qa(e){return new Promise(t=>setTimeout(t,e))}function Ja({headers:e,url:t,customFetchApi:n=fetch,retries:r=0,logger:a}){En({client:Ut,retries:r});const i={headers:e,url:t,retries:r},o=Za(a),s=Ya({customFetchApi:n,clientLogger:o,defaultRetryWaitTime:wn}),l=Xa(s,i),c=to(l),d=so(l);return{config:i,fetch:l,request:c,requestStream:d}}function Za(e){return t=>{e&&e(t)}}async function In(e){const{errors:t,data:n,extensions:r}=await e.json();return f(f(f({},I("data",n)),I("extensions",r)),t||!n?{errors:E(f({networkStatusCode:e.status,message:H(t?fn:bn)},I("graphQLErrors",t)),{response:e})}:{})}function Xa(e,{url:t,headers:n,retries:r}){return async(a,i={})=>{const{variables:o,headers:s,url:l,retries:c}=i,d=JSON.stringify({query:a,variables:o});En({client:Ut,retries:c});const h=Object.entries(f(f({},n),s)).reduce((p,[v,C])=>(p[v]=Array.isArray(C)?C.join(", "):C.toString(),p),{});!h[We]&&!h[je]&&(h[We]=Wa,h[je]=ja);const y=[l!=null?l:t,{method:"POST",headers:h,body:d}];return e(y,1,c!=null?c:r)}}function to(e){return async(...t)=>{if(Cn.test(t[0]))throw new Error(H("This operation will result in a streamable response - use requestStream() instead."));try{const n=await e(...t),{status:r,statusText:a}=n,i=n.headers.get("content-type")||"";return n.ok?i.includes(ee.json)?In(n):{errors:{networkStatusCode:r,message:H("".concat(gn," ").concat(i)),response:n}}:{errors:{networkStatusCode:r,message:H(a),response:n}}}catch(n){return{errors:{message:it(n)}}}}}function eo(e){return J(this,null,function*(){const t=new TextDecoder;if(e.body[Symbol.asyncIterator])try{for(var n=M(e.body),r,a,i;r=!(a=yield new L(n.next())).done;r=!1){const o=a.value;yield t.decode(o)}}catch(o){i=[o]}finally{try{r&&(a=n.return)&&(yield new L(a.call(n)))}finally{if(i)throw i[0]}}else{const o=e.body.getReader();let s;try{for(;!(s=yield new L(o.read())).done;)yield t.decode(s.value)}finally{o.cancel()}}})}function no(e,t){return{[Symbol.asyncIterator](){return J(this,null,function*(){try{let o="";try{for(var n=M(e),r,a,i;r=!(a=yield new L(n.next())).done;r=!1){const s=a.value;if(o+=s,o.indexOf(t)>-1){const l=o.lastIndexOf(t),c=o.slice(0,l).split(t).filter(d=>d.trim().length>0).map(d=>d.slice(d.indexOf(Ge)+Ge.length).trim());c.length>0&&(yield c),o=o.slice(l+t.length),o.trim()==="--"&&(o="")}}}catch(s){i=[s]}finally{try{r&&(a=n.return)&&(yield new L(a.call(n)))}finally{if(i)throw i[0]}}}catch(o){throw new Error("Error occured while processing stream payload - ".concat(it(o)))}})}}}function ro(e){return{[Symbol.asyncIterator](){return J(this,null,function*(){const t=yield new L(In(e));yield E(f({},t),{hasNext:!1})})}}}function ao(e){return e.map(t=>{try{return JSON.parse(t)}catch(n){throw new Error("Error in parsing multipart response - ".concat(it(n)))}}).map(t=>{const{data:n,incremental:r,hasNext:a,extensions:i,errors:o}=t;if(!r)return E(f(f({data:n||{}},I("errors",o)),I("extensions",i)),{hasNext:a});const s=r.map(({data:l,path:c,errors:d})=>f({data:l&&c?Sn(c,l):{}},I("errors",d)));return E(f({data:s.length===1?s[0].data:Pn([...s.map(({data:l})=>l)])},I("errors",An(s))),{hasNext:a})})}function oo(e,t){if(e.length>0)throw new Error(fn,{cause:{graphQLErrors:e}});if(Object.keys(t).length===0)throw new Error(bn)}function io(e,t){var n;const r=(t!=null?t:"").match(Ga),a="--".concat(r?r[1]:"-");if(!((n=e.body)!=null&&n.getReader)&&!e.body[Symbol.asyncIterator])throw new Error("API multipart response did not return an iterable body",{cause:e});const i=eo(e);let o={},s;return{[Symbol.asyncIterator](){return J(this,null,function*(){var l,c;try{let v=!0;try{for(var d=M(no(i,a)),h,y,p;h=!(y=yield new L(d.next())).done;h=!1){const C=y.value,G=ao(C);s=(c=(l=G.find(Se=>Se.extensions))==null?void 0:l.extensions)!=null?c:s;const ve=An(G);o=Pn([o,...G.map(({data:Se})=>Se)]),v=G.slice(-1)[0].hasNext,oo(ve,o),yield E(f(f({},I("data",o)),I("extensions",s)),{hasNext:v})}}catch(C){p=[C]}finally{try{h&&(y=d.return)&&(yield new L(y.call(d)))}finally{if(p)throw p[0]}}if(v)throw new Error("Response stream terminated unexpectedly")}catch(v){const C=vn(v);yield E(f(f({},I("data",o)),I("extensions",s)),{errors:E(f({message:H(it(v)),networkStatusCode:e.status},I("graphQLErrors",C==null?void 0:C.graphQLErrors)),{response:e}),hasNext:!1})}})}}}function so(e){return async(...t)=>{if(!Cn.test(t[0]))throw new Error(H("This operation does not result in a streamable response - use request() instead."));try{const n=await e(...t),{statusText:r}=n;if(!n.ok)throw new Error(r,{cause:n});const a=n.headers.get("content-type")||"";switch(!0){case a.includes(ee.json):return ro(n);case a.includes(ee.multipart):return io(n,a);default:throw new Error("".concat(gn," ").concat(a),{cause:n})}}catch(n){return{[Symbol.asyncIterator](){return J(this,null,function*(){const r=vn(n);yield{errors:f(f({message:H(it(n))},I("networkStatusCode",r==null?void 0:r.status)),I("response",r)),hasNext:!1}})}}}}}const lo="mutation cartCreate($input:CartInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartCreate(input:$input){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",co="mutation cartBillingAddressUpdate($cartId:ID!$billingAddress:MailingAddressInput$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartBillingAddressUpdate(cartId:$cartId billingAddress:$billingAddress){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",uo="mutation cartBuyerIdentityUpdate($cartId:ID!$buyerIdentity:CartBuyerIdentityInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartBuyerIdentityUpdate(cartId:$cartId buyerIdentity:$buyerIdentity){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",ho="mutation cartSelectedDeliveryOptionsUpdate($cartId:ID!$selectedDeliveryOptions:[CartSelectedDeliveryOptionInput!]!$country:CountryCode=CA$language:LanguageCode=EN$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartSelectedDeliveryOptionsUpdate(cartId:$cartId selectedDeliveryOptions:$selectedDeliveryOptions){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",po="mutation applePaySessionCreate($validationUrl:URL!){applePaySessionCreate(validationUrl:$validationUrl){...@defer{applePaySession{body}}}}",mo="mutation PayPalBuyerDetailsFetch($token:String!){paypalBuyerDetailsFetch(token:$token){...@defer{paypalDetails{email expiresAt destinationAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}billingAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}}}}}",yo="mutation PayPalTokenCreate($cartId:ID!){paypalTokenCreate(cartId:$cartId){...@defer{paypalToken{token}}}}",fo="query cartQuery($id:ID!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){cart(id:$id){...@defer(if:$withCarrierRates){...CartParts}}}",go="query subscriptionPolicyQuery($country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){shop{subscriptionPolicy(sanitized:true){body}}}",bo="mutation cartPaymentUpdate($cartId:ID!$input:CartPaymentInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartPaymentUpdate(cartId:$cartId payment:$input){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}}}}",Ye="fragment CartParts on Cart{id checkoutUrl buyerIdentity{deliveryAddressPreferences{...on MailingAddress{address1 address2 city province phone country firstName lastName zip}}}deliveryGroups(first:10 withCarrierRates:$withCarrierRates){edges{node{id groupType selectedDeliveryOption{code title description handle estimatedCost{amount currencyCode}}deliveryOptions{code title description estimatedCost{amount currencyCode}handle}}}}cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}totalTaxAmount{amount currencyCode}totalDutyAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}discountCodes{code applicable}lines(first:10){edges{node{quantity cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}merchandise{...on ProductVariant{requiresShipping}}sellingPlanAllocation{priceAdjustments{price{amount currencyCode}}sellingPlan{billingPolicy{...on SellingPlanRecurringBillingPolicy{interval intervalCount}}priceAdjustments{orderCount}recurringDeliveries}}}}}}",wo="mutation cartSubmitForCompletion($cartId:ID!$attemptToken:String!$country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){cartSubmitForCompletion(cartId:$cartId attemptToken:$attemptToken){result{__typename ...on SubmitSuccess{redirectUrl}...on SubmitThrottled{pollAfterV2:pollAfter}...on SubmitFailed{errors{code message}}}errors:userErrors{...on CartUserError{code field message}}}}",Co="unstable";class ht extends Error{constructor(t="No response"){super(t),this.name="NoResponseError"}}class zt{constructor({accessToken:t,country:n,locale:r,apiVersion:a=Co,withCarrierRates:i=!1}){if(u(this,"client"),u(this,"country"),u(this,"locale"),u(this,"withCarrierRates"),!t)throw new Error("StorefrontApiClient constructed with no access token");if(!n)throw new Error("StorefrontApiClient constructed with no buyer country");if(!r)throw new Error("StorefrontApiClient constructed with no locale");this.country=n,this.locale=r,this.withCarrierRates=i;const o="/api/".concat(a,"/graphql.json");this.client=Ja({headers:{"Content-Type":"application/json",Accept:"application/json","X-Shopify-Storefront-Access-Token":t,"X-SDK-Variant":"portable-wallets"},url:o,retries:0,logger:s=>{if(s.type==="HTTP-Response"){const[l,c]=s.content.requestParams;g.leaveBreadcrumb("POST: ".concat(l),{statusCode:s.content.response.status,statusText:s.content.response.statusText,url:l,method:c==null?void 0:c.method,headers:c==null?void 0:c.headers,body:c==null?void 0:c.body},"request")}}})}async createCart(t){var n;return this.requestDeferredCart(lo,{input:{lines:[{merchandiseId:t.merchandiseId,quantity:t.quantity,sellingPlanId:t.sellingPlanId,attributes:Object.entries((n=t.lineItemProperties)!=null?n:{}).map(([r,a])=>({key:r,value:a}))}],discountCodes:t.discountCodes,buyerIdentity:t.buyerIdentity}})}async updateCartBillingAddress(t){const{cartId:n,billingAddress:r}=t;return this.requestDeferredCart(co,{cartId:n,billingAddress:r})}async updateCartBuyerIdentity(t){const{cartId:n,emailAddress:r,streetAddress:a,countryCode:i,phone:o}=t;return this.requestDeferredCart(uo,{cartId:n,buyerIdentity:{email:r,countryCode:i!=null?i:a==null?void 0:a.country,phone:o!=null?o:a==null?void 0:a.phone,deliveryAddressPreferences:a?[{deliveryAddressValidationStrategy:t.validateAddress?"STRICT":"COUNTRY_CODE_ONLY",deliveryAddress:a}]:[]}})}async updateSelectedDeliveryOptions(t,n,r){let a=n;const i=Date.now()+2e4;for(;Date.now()<i&&!(r!=null&&r.aborted);){const o=await this.requestDeferredCart(ho,{cartId:t,selectedDeliveryOptions:a});if(!o.errors.some(l=>l.startsWith(w.PendingDeliveryGroups)))return o;const s=o.data.deliveryGroups.flatMap(l=>l.deliveryOptions.map(c=>({deliveryOptionHandle:c.handle,deliveryGroupId:l.id})));a=a.map(l=>{var c;return(c=s.find(d=>d.deliveryOptionHandle===l.deliveryOptionHandle))!=null?c:l})}throw new Error("Selected delivery options update operation timed out")}async applePaySessionCreate(t){var n,r,a;const i=await this.requestStream([po],{validationUrl:t.toString()});try{for(var o=M(i),s,l,c;s=!(l=await o.next()).done;s=!1){const d=l.value;d.errors&&this.onError(d.errors);const h=(a=(r=(n=d.data)==null?void 0:n.applePaySessionCreate)==null?void 0:r.applePaySession)==null?void 0:a.body;if(h)return h}}catch(d){c=[d]}finally{try{s&&(l=o.return)&&await l.call(o)}finally{if(c)throw c[0]}}throw new ht("Apple Pay session create operation returned no response")}async paypalBuyerDetailsFetch(t){var n,r;const a=await this.requestStream([mo],{token:t});try{for(var i=M(a),o,s,l;o=!(s=await i.next()).done;o=!1){const c=s.value;if(c.hasNext)continue;c.errors&&this.onError(c.errors);const d=(r=(n=c.data)==null?void 0:n.paypalBuyerDetailsFetch)==null?void 0:r.paypalDetails;if(d)return d}}catch(c){l=[c]}finally{try{o&&(s=i.return)&&await s.call(i)}finally{if(l)throw l[0]}}throw new ht("PayPal buyer details fetch operation returned no response")}async paypalTokenCreate(t){var n,r,a;const i=await this.requestStream([yo],{cartId:t});try{for(var o=M(i),s,l,c;s=!(l=await o.next()).done;s=!1){const d=l.value;d.errors&&this.onError(d.errors);const h=(a=(r=(n=d.data)==null?void 0:n.paypalTokenCreate)==null?void 0:r.paypalToken)==null?void 0:a.token;if(h)return h}}catch(d){c=[d]}finally{try{s&&(l=o.return)&&await l.call(o)}finally{if(c)throw c[0]}}throw new ht("PayPal token create operation returned no response")}async fetchCart(t){var n;const r=this.formatLanguage(this.locale),a=await this.requestStream([fo,Ye],{id:t,country:this.country,language:r,withCarrierRates:this.withCarrierRates});try{for(var i=M(a),o,s,l;o=!(s=await i.next()).done;o=!1){const c=s.value;c.errors&&this.onError(c.errors);const d=(n=c.data)==null?void 0:n.cart;if(g.leaveBreadcrumb("Fetch cart response",{body:d,hasNext:c.hasNext},"log"),d&&!c.hasNext)return this.parseCartResponse(d)}}catch(c){l=[c]}finally{try{o&&(s=i.return)&&await s.call(i)}finally{if(l)throw l[0]}}throw new ht("Cart fetch operation returned no response")}async updateCartPayment(t,n,r){var a,i;const o={cartId:t,input:n},{amount:s,currencyCode:l}=n.amount;let c;const d=Date.now()+1e4;for(;Date.now()<d&&!(r!=null&&r.aborted);){const h=await this.requestDeferredCart(bo,o);if(c||(c=h),h.errors.includes(w.InvalidPaymentAmount)){parseFloat((i=(a=h.data.totalTaxAmount)==null?void 0:a.amount)!=null?i:"0")===0&&await new Promise(y=>setTimeout(y,500)),o.input.amount={amount:h.data.totalAmount.amount,currencyCode:h.data.totalAmount.currencyCode};continue}return(h.data.totalAmount.amount===s||parseFloat(h.data.totalAmount.amount)<=parseFloat(s))&&h.data.totalAmount.currencyCode===l?h:c}throw new Error("Payment update operation timed out")}async submitForCompletion(t,n){var r,a;const i=this.formatLanguage(this.locale),o=await this.request([wo],{cartId:t,attemptToken:n,country:this.country,language:i,withCarrierRates:this.withCarrierRates});return{data:(a=(r=o.data)==null?void 0:r.cartSubmitForCompletion)==null?void 0:a.result,errors:this.parseCompletionErrors(o)}}async fetchSubscriptionPolicy(){var t,n;const{data:r}=await this.request([go],{country:this.country,language:this.formatLanguage(this.locale)});return(n=(t=r==null?void 0:r.shop)==null?void 0:t.subscriptionPolicy)==null?void 0:n.body}async request(t,n){return this.client.request(t.join(""),{variables:n})}async requestStream(t,n){return this.client.requestStream(t.join(""),{variables:n})}async requestDeferredCart(t,n){var r,a;const i=this.formatLanguage(this.locale),o=await this.requestStream([t,Ye],E(f({},n),{country:this.country,language:i,withCarrierRates:this.withCarrierRates}));try{for(var s=M(o),l,c,d;l=!(c=await s.next()).done;l=!1){const h=c.value;h.errors&&this.onError(h.errors);const y=(a=(r=h.data)==null?void 0:r.result)==null?void 0:a.cart;if(y&&!h.hasNext)return{data:await this.fetchCart(y.id),errors:this.parseMutationErrors(h,"result")}}}catch(h){d=[h]}finally{try{l&&(c=s.return)&&await c.call(s)}finally{if(d)throw d[0]}}throw new ht("Deferred cart operation returned no response")}onError(t){var n,r;if(!t)return;g.leaveBreadcrumb("GraphQL response error",t,"error");const a=(r=(n=t.graphQLErrors)==null?void 0:n.map(s=>s.message).join(", "))!=null?r:"",i="".concat(t.message).concat(a.length>0?" - ".concat(a):""),o=t!=null&&t.networkStatusCode?"with status ".concat(t.networkStatusCode," => ").concat(i):"=> ".concat(i);throw new Error("GraphQL mutation failed ".concat(o))}formatLanguage(t){return t.includes("-")?t.split("-")[0].toUpperCase():t.toUpperCase()}parseCartResponse(t){var n,r,a;const i=t.lines.edges.map(s=>{var l,c;const d=s.node;return{quantity:d.quantity,totalAmount:{amount:d.cost.totalAmount.amount,currencyCode:d.cost.totalAmount.currencyCode},subtotalAmount:{amount:(l=d.cost.subtotalAmount)==null?void 0:l.amount,currencyCode:(c=d.cost.subtotalAmount)==null?void 0:c.currencyCode},merchandise:{requiresShipping:d.merchandise.requiresShipping},discountAllocations:d.discountAllocations,sellingPlanAllocation:d.sellingPlanAllocation}}),o=t.deliveryGroups.edges.map(s=>s.node);return{id:t.id,totalAmount:t.cost.totalAmount,subtotalAmount:(n=t.cost.subtotalAmount)!=null?n:void 0,totalTaxAmount:(r=t.cost.totalTaxAmount)!=null?r:void 0,totalDutyAmount:(a=t.cost.totalDutyAmount)!=null?a:void 0,discountAllocations:t.discountAllocations,discountCodes:t.discountCodes,lineItems:i,deliveryGroups:o,checkoutUrl:t.checkoutUrl}}parseGraphQlErrors(t){var n,r;return(r=(n=t==null?void 0:t.graphQLErrors)==null?void 0:n.map(a=>a.message.replace(/\(Expected.*\)/,"").trim()))!=null?r:[]}parseMutationErrors(t,n){var r,a,i;const o=this.parseGraphQlErrors(t.errors),s=((i=(a=(r=t.data)==null?void 0:r[n])==null?void 0:a.errors)==null?void 0:i.map(c=>c.field&&c.field.length>0?"".concat(c.code,": ").concat(c.field.join(".")):c.code).filter(c=>c))||[],l=[...o,...s];return g.leaveBreadcrumb("GraphQL errors on mutation",l,"error"),l}parseCompletionErrors(t){var n,r,a,i;const o=this.parseGraphQlErrors(t.errors);let s=[];((a=(r=(n=t.data)==null?void 0:n.cartSubmitForCompletion)==null?void 0:r.result)==null?void 0:a.__typename)==="SubmitFailed"&&(s=(i=t.data.cartSubmitForCompletion.result.errors.map(c=>c.code))!=null?i:[]);const l=[...o,...s];return g.leaveBreadcrumb("GraphQL errors on completion",l,"error"),l}}async function vo({cartId:e,cartClient:t,instrumentName:n,selectedDeliveryOptions:r,abortSignal:a}){try{if(!e)throw new Error("[".concat(n,"] provided no cart ID when updating shipping method"));if(!t)throw new Error("[".concat(n,"] provided invalid cart client when updating shipping method"));return await t.updateSelectedDeliveryOptions(e,r,a)}catch(i){throw m.updateFailed(n,"updateSelectedDeliveryOptions"),i}}async function Ao({cartId:e,token:t,cartClient:n,instrumentName:r}){try{if(!e)throw new Error("[".concat(r,"] provided no cart ID when submitting for completion"));if(!n)throw new Error("[".concat(r,"] provided invalid cart client when submitting for completion"));if(!t)throw new Error("[".concat(r,"] provided no token when submitting for completion"));return await n.submitForCompletion(e,t)}catch(a){throw m.updateFailed(r,"submitForCompletion"),a}}function Eo({selectedDeliveryOptionHandles:e,deliveryGroups:t,instrumentName:n}){return t.map(r=>{const a=r.deliveryOptions.filter(i=>e.includes(i.handle));if(!a.length)throw new Error("[".concat(n,"] could not find delivery option for group: ").concat(r.id));if(a.length>1)throw new Error("[".concat(n,"] found multiple delivery options with selectedDeliverOptionHandle in group: ").concat(r.id));return{deliveryGroupId:r.id,deliveryOptionHandle:a[0].handle}})}async function So(e){const{cartClient:t,instrumentName:n}=e;try{if(!e.cartId)throw new Error("[".concat(n,"] provided no cart ID when updating billing address"));if(!t)throw new Error("[".concat(n,"] provided invalid cart client when updating billing address"));return await t.updateCartBillingAddress(e)}catch(r){throw m.updateFailed(n,"updateBillingAddress"),r}}class _o{constructor({accessToken:t,buyerCountry:n,buyerCurrency:r,button:a,i18n:i,merchantName:o,dataSource:s,apiClient:l,walletParams:c}){u(this,"name",b.ApplePay),u(this,"accessToken"),u(this,"button"),u(this,"buyerCountry"),u(this,"cart"),u(this,"apiClient"),u(this,"dataSource"),u(this,"i18n"),u(this,"merchantName"),u(this,"session"),u(this,"paymentSheetActionGenerator"),u(this,"cancelled"),u(this,"buyerCurrency"),u(this,"abortController",null),u(this,"begin",()=>{g.leaveBreadcrumb("ApplePay Session begin",{},"log"),this.abortController=typeof AbortController=="function"&&new AbortController||null,this.session.begin()}),u(this,"onvalidatemerchant",async d=>{try{const h=new URL(d.validationURL),y=this.getMerchantSession(h),{cart:p}=await j({element:this.button,instrumentName:this.name,dataSource:this.dataSource});this.cart=p;const v=await y;if(g.leaveBreadcrumb("ApplePay Session completeMerchantValidation",{session:v},"log"),this.sessionIsCancelled())return;this.session.completeMerchantValidation(v)}catch(h){m.sheetClicked({instrument:b.ApplePay,result:"failed"}),this.terminateSession(h)}}),u(this,"onshippingcontactselected",async d=>{try{const h=At(d.shippingContact),y=await Pt({cartId:this.cart.id,streetAddress:h,cartClient:this.apiClient,instrumentName:this.name});if(this.decelerateIfCurrencyChanged(y.data))return;await this.applyPaymentSheetActions(y,p=>this.completeShippingContactSelection(y.data,p),{shippingRequired:this.isShippingRequired})}catch(h){this.terminateSession(h)}}),u(this,"onshippingmethodselected",async d=>{var h;try{const y=d.shippingMethod.identifier.split(","),p=Eo({selectedDeliveryOptionHandles:y,deliveryGroups:this.cart.deliveryGroups,instrumentName:this.name}),v=await vo({cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name,selectedDeliveryOptions:p,abortSignal:(h=this.abortController)==null?void 0:h.signal});await this.applyPaymentSheetActions(v,()=>this.completeShippingMethodSelection(v.data))}catch(y){this.terminateSession(y)}}),u(this,"onpaymentmethodselected",async d=>{try{const{billingContact:h}=d.paymentMethod;if(!this.isShippingRequired&&h){const v=At(h),C=await Pt({cartId:this.cart.id,countryCode:v.country,cartClient:this.apiClient,instrumentName:this.name});if(this.decelerateIfCurrencyChanged(C.data))return;await this.applyPaymentSheetActions(C,()=>this.cart=C.data);const G=await So({billingAddress:v,cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name});await this.applyPaymentSheetActions(G,()=>this.cart=G.data)}const{newTotal:y,newLineItems:p}=this.getNewTotalAndLineItems(this.cart);if(g.leaveBreadcrumb("ApplePay Session completePaymentMethodSelection",{newTotal:y,newLineItems:p},"log"),this.sessionIsCancelled())return;this.session.completePaymentMethodSelection({newTotal:y,newLineItems:p})}catch(h){this.terminateSession(h)}}),u(this,"oncancel",()=>{var d;this.cancelled=!0,m.sheetCancelled(this.name),this.button.disabled=!1,(d=this.abortController)==null||d.abort()}),u(this,"onpaymentauthorized",async d=>{m.authorizationAttempt(this.name),Bt(D.AuthorizationLatency,this.name);const h=A=>{m.authorizationComplete({instrument:this.name,measurement:rt(D.AuthorizationLatency,this.name),result:"failure"}),this.terminateSession(A)},y=async A=>{var we,Ae;switch((we=A.effects)==null||we.forEach(Y=>Y()),A.action){case"complete":{const Y=ApplePaySession.STATUS_SUCCESS;try{await this.completePayment(Y),ot(A.redirectUrl)}catch(Ce){h(Ce)}break}case"show_error":{const Y=(Ae=A.errors)!=null?Ae:[];try{await this.completePayment(ApplePaySession.STATUS_FAILURE,Y)}catch(Ce){h(Ce)}break}case"abort":{try{await this.completePayment(ApplePaySession.STATUS_FAILURE),this.button.disabled=!1}catch(Y){h(Y)}break}default:h(new Error("[".concat(this.name,"] completion action not handled: ").concat(A.action)))}},{token:p,billingContact:v,shippingContact:C}=d.payment;let G=null,ve=null;try{if(!v){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}if(G=At(E(f({},v),{phoneNumber:C==null?void 0:C.phoneNumber})),this.isShippingRequired){if(!C){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}ve=At(C)}}catch(A){h(A);return}const Se=async()=>{try{const A=this.isShippingRequired?{validateAddress:!0,streetAddress:ve}:{},we=await Pt(f({cartId:this.cart.id,emailAddress:C.emailAddress,cartClient:this.apiClient,instrumentName:this.name},A)),Ae=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(we);await Wt({paymentSheetAction:Ae,onProceed:async Y=>{Y&&Y.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,Y):await Pe()},terminateSession:h})}catch(A){h(A)}},Pe=async()=>{var A;try{const we=this.cart.lineItems.some(Ce=>!!Ce.sellingPlanAllocation),Ae=await mn({cartId:this.cart.id,totalAmount:this.cart.totalAmount,paymentMethod:{walletPaymentMethod:{applePayWalletContent:{billingAddress:G,data:p.paymentData.data,header:p.paymentData.header,lastDigits:p.paymentMethod.displayName.split(" ")[1],signature:p.paymentData.signature,version:p.paymentData.version}}},billingAddress:G,cartClient:this.apiClient,instrumentName:this.name,hasSellingPlan:we,abortSignal:(A=this.abortController)==null?void 0:A.signal}),Y=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(Ae);await Wt({paymentSheetAction:Y,onProceed:async Ce=>{Ce&&Ce.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,Ce):await Ie()},terminateSession:h})}catch(we){h(we)}},Ie=async()=>{try{const A=await Ao({cartId:this.cart.id,token:p.transactionIdentifier,cartClient:this.apiClient,instrumentName:this.name}),we=this.paymentSheetActionGenerator.mapCompletionResultToPaymentSheetAction(A);await y(we)}catch(A){h(A)}};await Se()}),u(this,"terminateSession",d=>{var h;this.button.disabled=!1,d&&g.notify(d);try{g.leaveBreadcrumb("ApplePay Session abort",{},"log"),this.session.abort(),(h=this.abortController)==null||h.abort()}catch(y){g.notify(y)}if(d){const y=this.i18n.translate("brand.apple_pay");$(this.i18n.translate("error_dialogs.wallet.title",{wallet:y}),this.i18n.translate("error_dialogs.wallet.generic_error",{wallet:y}))}}),u(this,"getMostRecentNonNullCart",(d,h)=>d?(this.cart=d,d):h),u(this,"handleNullCart",d=>{if(!d)throw new Error("[".concat(this.name,"] no cart returned on mutation, aborting"))}),u(this,"completeShippingContactSelection",(d,h)=>{try{const y=this.getMostRecentNonNullCart(d,this.cart),{newTotal:p,newLineItems:v}=this.getNewTotalAndLineItems(y),C=$a(y.deliveryGroups,this.i18n);g.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{errors:h,newTotal:p,newLineItems:v,newShippingMethods:C},"log"),this.session.completeShippingContactSelection({errors:h!=null?h:[],newTotal:p,newLineItems:v,newShippingMethods:C})}catch(y){this.terminateSession(y)}}),u(this,"completeShippingMethodSelection",d=>{try{this.handleNullCart(d),this.cart=d;const{newTotal:h,newLineItems:y}=this.getNewTotalAndLineItems(d);g.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{newTotal:h,newLineItems:y},"log"),this.session.completeShippingMethodSelection({newTotal:h,newLineItems:y})}catch(h){this.terminateSession(h)}}),u(this,"sessionIsCancelled",()=>this.cancelled),this.accessToken=t,this.buyerCountry=n,this.button=a,this.cart=null,this.apiClient=l,this.dataSource=s,this.i18n=i,this.merchantName=o,this.cancelled=!1,this.buyerCurrency=r,this.session=new ApplePaySession(tn,Ua({shippingRequired:this.isShippingRequired,walletParams:c,buyerCurrency:r})),this.session.onvalidatemerchant=this.onvalidatemerchant,this.session.onshippingcontactselected=this.onshippingcontactselected,this.session.onshippingmethodselected=this.onshippingmethodselected,this.session.onpaymentmethodselected=this.onpaymentmethodselected,this.session.oncancel=this.oncancel,this.session.onpaymentauthorized=this.onpaymentauthorized,this.paymentSheetActionGenerator=new Ba(i)}async applyPaymentSheetActions(t,n,r){var a;const i=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction(t,r);(a=i.effects)==null||a.forEach(o=>o()),!this.sessionIsCancelled()&&await Wt({paymentSheetAction:i,onProceed:n,terminateSession:this.terminateSession})}async getMerchantSession(t){const n=await new zt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,apiVersion:"unstable"}).applePaySessionCreate(t);return JSON.parse(n)}async completePayment(t,n=void 0){g.leaveBreadcrumb("ApplePay Session completePayment",{status:t,errors:n},"log"),this.session.completePayment({status:t,errors:n}),m.authorizationComplete({instrument:this.name,measurement:rt(D.AuthorizationLatency,this.name),result:t===ApplePaySession.STATUS_SUCCESS?"success":"failure"})}getNewTotalAndLineItems(t){return{newTotal:ka(this.merchantName,t.totalAmount),newLineItems:Ta({subtotal:za(t),discountAllocations:qa(t),deliveryGroups:t.deliveryGroups,duties:t.totalDutyAmount,taxes:t.totalTaxAmount,i18n:this.i18n,formattedRecurringTotals:Ha(this.cart.lineItems,this.i18n)})}}decelerateIfCurrencyChanged(t){const n=t!=null?t:this.cart;if(!n)return!1;const r=n.totalAmount.amount;if(!r||Number(r)===0||this.buyerCurrency.toUpperCase()===n.totalAmount.currencyCode.toUpperCase())return!1;const a=new URL(n.checkoutUrl);return a.searchParams.set(rr.CURRENCY_CHANGE,"true"),m.decelerated({instrument:this.name,reason:"currency_changed"}),window.location.assign(a),this.terminateSession(),!0}get isShippingRequired(){return this.button.isShippingRequired}}const Po='<svg viewBox="0 0 43 19" xmlns="http://www.w3.org/2000/svg" width="45px" style="width: 45px;">\n  <path d="M6.948 1.409C7.934.147 9.305.147 9.305.147s.193 1.18-.771 2.316c-1.05 1.2-2.228.993-2.228.993s-.236-.93.642-2.047zM3.82 3.663c-1.735 0-3.6 1.51-3.6 4.363 0 2.916 2.186 6.555 3.943 6.555.6 0 1.543-.6 2.485-.6.922 0 1.607.559 2.464.559 1.907 0 3.322-3.826 3.322-3.826s-2.015-.744-2.015-2.936c0-1.944 1.629-2.73 1.629-2.73s-.836-1.447-2.936-1.447c-1.22 0-2.164.661-2.656.661-.622.021-1.5-.6-2.636-.6zM19.64 1.426c2.453 0 4.188 1.788 4.188 4.396 0 2.608-1.755 4.417-4.248 4.417h-2.932v4.564h-1.974V1.426h4.966zm-2.992 7.067h2.473c1.695 0 2.693-.967 2.693-2.65 0-1.683-.978-2.671-2.693-2.671h-2.473v5.321zm7.559 3.429c0-1.767 1.296-2.777 3.65-2.945l2.572-.147v-.78c0-1.156-.738-1.787-1.994-1.787-1.037 0-1.795.568-1.955 1.43h-1.775c.06-1.788 1.656-3.092 3.79-3.092 2.333 0 3.829 1.304 3.829 3.281v6.9h-1.815v-1.684h-.04c-.519 1.094-1.715 1.788-3.012 1.788-1.934.021-3.25-1.178-3.25-2.965zm6.222-.905v-.778l-2.313.168c-1.297.084-1.975.59-1.975 1.494 0 .862.718 1.409 1.815 1.409 1.396-.021 2.473-.968 2.473-2.293zm3.969 7.383v-1.64c.14.041.438.041.598.041.897 0 1.416-.4 1.735-1.472l.14-.526L33.4 4.707h2.054l2.453 8.224h.04L40.4 4.707h1.994l-3.57 10.538c-.818 2.419-1.715 3.197-3.67 3.197-.14.02-.598-.021-.757-.042z"/>\n</svg>\n',jt="{{ICON}}";class Io extends W{constructor(){super(),u(this,"fragment",null),u(this,"button",null),u(this,"logoElement"),this.logoElement=new DOMParser().parseFromString(Po,"image/svg+xml").documentElement}static get observedAttributes(){return["disabled"]}get merchantName(){return this.walletParams.merchantName}async connectedCallback(){this.render()}attributeChangedCallback(t,n,r){super.attributeChangedCallback(t,n,r,this.button)}async handleClick(t){if(t.preventDefault(),this.disabled||!this.button||this.button.hasAttribute("aria-disabled"))return;this.disabled=!0;const[n,r,a]=await Promise.all([this.i18n,this.dataSource,this.apiClient]);let i;try{if(i=new _o({accessToken:this.accessToken,buyerCountry:this.buyerCountry,buyerCurrency:this.buyerCurrency,button:this,i18n:n,merchantName:this.merchantName,dataSource:r,apiClient:a,walletParams:this.walletParams}),!i)throw new Error("missing ApplePaySession");i.begin(),m.sheetClicked({instrument:b.ApplePay,result:"success"})}catch(o){g.notify(o),m.sheetClicked({instrument:b.ApplePay,result:"failed"}),i==null||i.terminateSession()}}async render(){var t;if(!this.button){const n=await this.classNames;this.button=Ft(),this.button.onclick=a=>this.handleClick(a),this.button.className="apple-pay-button ".concat(tr[this.buttonTheme]," ").concat(n);const r=this.hasAttribute("call-to-action");await this.addBranding(this.button,r)}if(this.disabled&&this.button.setAttribute("aria-disabled","true"),!this.fragment){this.fragment=document.createDocumentFragment();const n=document.createElement("style");n.innerHTML=Pa,this.fragment.append(n,this.button),this.appendChild(this.fragment),(t=this.onRendered)==null||t.call(this)}}async addBranding(t,n){const r=await this.i18n,a=r.translate("buy_with_button_content"),i=r.translate("brand.apple_pay");t.setAttribute("aria-label",n?a.replace(jt,i):i),t.appendChild(this.htmlContent(n?a:null))}htmlContent(t){if(!t)return this.logoElement;const n=document.createElement("div");return n.classList.add("apple-pay--content"),t.split(new RegExp("(".concat(jt,")"))).filter(Boolean).map(r=>{let a;r===jt?a=this.logoElement:(a=document.createElement("span"),a.innerText=r,a.setAttribute("aria-hidden","true")),n.appendChild(a)}),n}}function ye(e){return function(t,n,r){const a=r.value;return r.value=function(...i){const o=a.apply(this,i);return o.eligible||console.debug("[DEBUG] ".concat(e," could not be rendered. Reason: ").concat(o.reason)),o},r}}var ko=Object.defineProperty,To=Object.getOwnPropertyDescriptor,kn=(e,t,n,r)=>{for(var a=r>1?void 0:r?To(t,n):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(a=(r?o(t,n,a):o(a))||a);return r&&a&&ko(t,n,a),a};class fe extends K{constructor(t){super(t),u(this,"companyFieldRequired"),this.companyFieldRequired=!!this.walletParams.companyRequired}static walletName(){return"apple_pay"}getWebComponentName(){return"shopify-apple-pay-button"}getWebComponentClass(){return Io}getInstrumentName(){return b.ApplePay}applePayInIframe(){return typeof window>"u"||window.self!==window.top}getLoadEligibility(){return this.applePayInIframe()?{eligible:!1,reason:"cannot be loaded in an iframe"}:{eligible:!0}}getPartnerSDKEligibility(){var t,n,r,a;return typeof window>"u"||window.ApplePaySession===void 0?{eligible:!1,reason:"window or ApplePaySession is undefined"}:(n=(t=window.ApplePaySession).supportsVersion)!=null&&n.call(t,tn)?(a=(r=window.ApplePaySession).canMakePayments)!=null&&a.call(r)?{eligible:!0}:{eligible:!1,reason:"failed SDK eligibility check"}:{eligible:!1,reason:"SDK does not meet minimum version requirement"}}}kn([ye("Apple Pay")],fe.prototype,"getLoadEligibility",1),kn([ye("Apple Pay")],fe.prototype,"getPartnerSDKEligibility",1);const Do=".buy-with-prime-button:hover:enabled{background-color:#0684eb!important}.buy-with-prime-button:focus{box-shadow:0 0 0 2px #1a98ff,inset 0 0 0 2px rgb(var(--color-background))!important;outline:none!important}.buy-with-prime-button:active,.buy-with-prime-button:hover:enabled:active{background-color:#0066cd!important;box-shadow:none!important}";class It extends Error{constructor(){super(...arguments),u(this,"name","MissingAccessTokenError")}}class ge extends Error{constructor(){super(...arguments),u(this,"name","FetchingWalletsPlatformConfigError")}}class Tn extends Error{constructor(){super(...arguments),u(this,"name","EmptyLineItemsWalletsPlatformConfigError")}}async function Dn({configOptionsEndpoint:e,checkoutUrl:t,sourceId:n,accessToken:r,instrument:a}){try{const i=JSON.stringify({checkout_url:t,checkout_cancel_url:window.location.href,cart_id:n}),o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":r},body:i});if(o.ok)return o.json();const s=await o.json();throw s.error?new Error(s.error):new Error("Could not fetch wallets platform configs: [".concat(o.status,"] ").concat(o.statusText))}catch(i){const{message:o}=i!=null?i:{};switch(o){case"empty_line_items":throw new Tn("[Fetch Pay Config][".concat(a,"] No eligible line items provided in the config request."));default:throw new ge("[Fetch Pay Config][".concat(a,"] ").concat(o))}}}const tt=class ke extends W{constructor(){super(...arguments),u(this,"fragment",null),u(this,"button",null)}async connectedCallback(){this.render()}disconnectedCallback(){}createButton(){const t=Ft();return t.type="button",t.role="button",t.className="buy-with-prime-button",ft(t,{width:"100%","padding-top":"12px","padding-bottom":"8px","padding-right":"10px","padding-left":"10px",display:"flex","align-items":"center","justify-content":"center",gap:"5px",opacity:"1","border-width":"0px"}),this.applyEnabledStyles(t),t}applyEnabledStyles(t){t.innerHTML=wt.primeLogo,t.disabled=!1,ft(t,{"background-color":"#1A98FF",color:"#FFFFFF",cursor:"pointer"})}applyDisabledStyles(t){t.innerHTML=wt.primeLogoDark,t.disabled=!0,ft(t,{"background-color":"#C0E3FF",color:"#7292AC",cursor:"not-allowed"})}async handleClick(){var t;if(!this.button)return;const[n,r]=await Promise.all([this.i18n,this.dataSource]);try{this.applyDisabledStyles(this.button);let a=this.walletParams;if(!a.createCheckoutSessionConfig){const{cart:i}=await j({element:this,instrumentName:b.BuyWithPrime,dataSource:r});if(!this.accessToken)throw new It("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");a=E(f({},await Dn({configOptionsEndpoint:ke.OPTIMUS_CONFIG_REST_API_URL,checkoutUrl:i.checkoutUrl,sourceId:(t=$t(i))!=null?t:"",accessToken:this.accessToken,instrument:b.BuyWithPrime})),{placement:this.pageType===k.ProductPage?"Product":"Cart"})}window.amazon.buywithprime.initCheckout({amazonPayOptions:a}),m.sheetClicked({instrument:b.BuyWithPrime,result:"success"})}catch(a){const{name:i}=a!=null?a:{};ke.EXPECTED_ERRORS.includes(i)||g.notify(a),m.sheetClicked({instrument:b.BuyWithPrime,result:"failed"});const{title:o,content:s}=this.getErrorCopies(i,n);$(o,s)}finally{this.applyEnabledStyles(this.button)}}getErrorCopies(t,n){switch(t){case"EmptyLineItemsWalletsPlatformConfigError":return{title:n.translate("error_dialogs.wallet.buy_with_prime.empty_line_items.title"),content:n.translate("error_dialogs.wallet.buy_with_prime.empty_line_items.content")};default:return{title:n.translate("error_dialogs.checkout.title"),content:n.translate("error_dialogs.checkout.generic_error")}}}async render(){var t;if(!this.button){const n=await this.classNames;this.button=this.createButton(),this.button.onclick=()=>this.handleClick(),this.button.className="buy-with-prime-button ".concat(n)}if(!this.fragment){this.fragment=document.createDocumentFragment();const n=document.createElement("style");n.innerHTML=Do,this.fragment.append(n,this.button),this.appendChild(this.fragment)}(t=this.onRendered)==null||t.call(this)}};u(tt,"OPTIMUS_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/optimus")),u(tt,"EXPECTED_ERRORS",[ge.name,It.name,Tn.name]);let ne=tt;async function Kt(e){const t=e.createCheckoutSessionConfig,n=JSON.parse(t.payloadJSON),r=new URL(n.webCheckoutDetails.checkoutReviewReturnUrl),a=await(await fetch("https:///sandbox/v2/checkoutSessions",{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"}})).json();r.searchParams.set("amazonCheckoutSessionId",a.checkoutSessionId||"testCheckoutSessionId"),r.searchParams.set("promiseId","testPromiseId"),ot(r.toString())}const Nn={buywithprime:{initCheckout:async e=>{Kt(e.amazonPayOptions)}},Pay:{initCheckout:async e=>{Kt(e)},renderButton:()=>({initCheckout:Kt,onClick:()=>{}})}};async function No(){return window.amazon=Nn,"loaded"}async function xo(e){return new Promise((t,n)=>{if(document.querySelector('script[src="'.concat(e,'"]'))&&window.amazon){t();return}const r=document.createElement("script");r.src=e,r.onload=()=>{window.amazon?t():n(new Error("Amazon SDK not present after loading"))},r.onerror=()=>{n(new Error("Error loading Amazon SDK"))},document.head.append(r)})}async function xn({sdkUrl:e=le,maxRetries:t=3,shouldMock:n=!1}){let r=0;if(n){await No();return}do try{await xo(e);break}catch(a){if(r++,r===t)throw a}while(r<t)}const O=class Ee extends K{static walletName(){return"buy_with_prime"}constructor(t){super(t)}getWebComponentName(){return"shopify-buy-with-prime-button"}getInstrumentName(){return b.BuyWithPrime}isMockedAmazonServiceUsed(){return!1}getWebComponentClass(){return ne}async loadWalletSDK(){await xn({sdkUrl:Ee.SDK_URL,shouldMock:this.isMockedAmazonServiceUsed(),maxRetries:Ee.MAX_RETRIES}),await this.loadLogos()}async loadLogos(){await Promise.all([this.loadPrimeLogo(),this.loadPrimeLogoDark()])}async loadPrimeLogo(){Ee.primeLogo=(await import("./prime-logo-CaEyIrNK.js")).default}async loadPrimeLogoDark(){Ee.primeLogoDark=(await import("./prime-logo-dark-C_wGaFh_.js")).default}};u(O,"MAX_RETRIES",3),u(O,"SDK_URL",le),u(O,"primeLogo"),u(O,"primeLogoDark");let wt=O;const U=class _e extends W{constructor(){super(...arguments),u(this,"container",null)}async connectedCallback(){await this.render()}async handleClick(t){var n;const[r,a]=await Promise.all([this.i18n,this.dataSource]);try{const{cart:i}=await j({element:this,instrumentName:b.AmazonPay,dataSource:a}),{totalAmount:{amount:o},checkoutUrl:s}=i;let l=this.walletParams;if(!l.createCheckoutSessionConfig){if(!this.accessToken)throw new It("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");l=E(f({},await Dn({configOptionsEndpoint:_e.CV2_CONFIG_REST_API_URL,checkoutUrl:s,sourceId:(n=$t(i))!=null?n:"",accessToken:this.accessToken,instrument:b.AmazonPay})),{placement:this.pageType===k.ProductPage?"Product":"Cart"})}t.initCheckout(f(f({},l),Number(o)!==0&&{estimatedOrderAmount:{amount:o,currencyCode:this.buyerCurrency}})),m.sheetClicked({instrument:b.AmazonPay,result:"success"})}catch(i){const{name:o}=i!=null?i:{};_e.EXPECTED_ERRORS.includes(o)||g.notify(i),m.sheetClicked({instrument:b.AmazonPay,result:"failed"});const s=r.translate("brand.amazon_pay");$(r.translate("error_dialogs.wallet.title",{wallet:s}),r.translate("error_dialogs.wallet.generic_error",{wallet:s}))}}createContainer(){const t=document.createElement("div");return t.id=_e.CONTAINER_ID,t.style.display="flex",t}async render(){var t;if(!this.container){this.container=this.createContainer(),this.appendChild(this.container);const n=window.amazon.Pay.renderButton("#".concat(_e.CONTAINER_ID),E(f({},this.walletParams),{placement:this.pageType===k.ProductPage?"Product":"Cart"}));n==null||n.onClick(()=>this.handleClick(n)),(t=this.onRendered)==null||t.call(this)}}};u(U,"CV2_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/amazon_pay")),u(U,"CONTAINER_ID","PortableWalletsAmazonPayButtonContainer"),u(U,"EXPECTED_ERRORS",[ge.name,It.name]);let re=U;const et=class Ne extends K{static walletName(){return"amazon_pay"}constructor(t){super(t)}getWebComponentName(){return"shopify-amazon-pay-button"}getInstrumentName(){return b.AmazonPay}isMockedAmazonServiceUsed(){return!1}getWebComponentClass(){return re}async loadWalletSDK(){if(await xn({sdkUrl:Ne.SDK_URL,shouldMock:!1,maxRetries:Ne.MAX_RETRIES}),this.isMockedAmazonServiceUsed()){const t=window.amazon.Pay.renderButton;window.amazon.Pay.renderButton=(n,r)=>{const a=t(n,r);return a.initCheckout=Nn.Pay.initCheckout,a}}}};u(et,"MAX_RETRIES",3),u(et,"SDK_URL",le);let ae=et;var Et={Purple:{D0:"#4524DB",D1:"#30368D",D2:"#1C234C",L0:"#6445ED",L1:"#9C83F8",L2:"#EEEAFF",L3:"#F7F5FF",Primary:"#5433EB",PrimaryLight:"#DBD1FF"},Grayscale:{Black:"#000000",D0:"#666666",D1:"#404040",D2:"#121212",D3:"#0B0B0C",D2D:"#2A2A2A",PrimaryLight:"#707070",L1:"#A8A8A7",L2:"#CBCBCA",L2L:"#E3E3E3",L3:"#F0F0F0",L4:"#F2F4F5",White:"#FFFFFF"},Green:{D1:"#008552",D2:"#004839",L1:"#BAEBCB",L2:"#D2F2DE",L3:"#E4F6EB",Primary:"#92D08D"},Poppy:{D0:"#F05D38",D1:"#D92A0F",D2:"#832711",L1:"#FFD2C2",L2:"#FFECE9",Primary:"#FF967D"},Ochre:{D0:"#F8DB67",D1:"#E3BE2B",D2:"#C29D05",D4:"#443600",L1:"#FFF4CB",L2:"#FFF9E2",Primary:"#FFEC9F"},Brand:{Aqua:"#8DC0C6",Lime:"#C7DE00",Magenta:"#D354FF",Olive:"#8B8F01",Sage:"#D8E59D",Sand:"#F4F4ED",Violet:"#A327C2"}},Ro={none:0,xs:4,xs100:6,s:8,s100:10,m:12,l:16,xl:20,xxl:28,max:999999},Lo={0:0,none:0,xxxs:2,xxs:4,xs:8,"xs-s":12,s:16,gutter:20,m:24,l:32,section:36,xl:40,xxl:48,xxxl:64,auto:"auto"},Oo=class extends HTMLElement{static get observedAttributes(){return["disabled"]}constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this._updateButton()}attributeChangedCallback(){this._updateButton()}_updateButton(){var e;let t=this.shadowRoot;t&&(t.innerHTML=Fo,this.hasAttribute("disabled")&&((e=this.shadowRoot.querySelector("button"))==null||e.setAttribute("disabled","")))}};function $o(){window.customElements&&(customElements.get("gravity-button")||customElements.define("gravity-button",Oo))}var Fo="\n<style>\n  * {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n    border-color: currentColor;\n  }\n\n  button {\n    text-transform: none;\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n    font-family: inherit;\n    font-feature-settings: inherit;\n    font-variation-settings: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    letter-spacing: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n    cursor: pointer;\n  }\n\n  button:disabled {\n    cursor: default;\n    opacity: 0.5;\n  }\n\n  .gravity-button {\n    position: relative;\n    display: flex;\n    width: var(--gravity-button-width, 260px);\n    justify-content: center;\n    color: ".concat(Et.Grayscale.White,";\n    align-items: center;\n    overflow: visible;\n    padding: ").concat(Lo.s,"px 10px;\n    border-radius: var(--buttons-radius, ").concat(Ro.m,"px);\n    border: none;\n    background-color: ").concat(Et.Purple.Primary,";\n    transition: all;\n  }\n\n  .gravity-button:not([disabled]):focus-visible {\n    box-shadow: 0 0 0 3px ").concat(Et.Purple.PrimaryLight,", 0 0 #0000;\n    outline: 2px solid transparent;\n    outline-offset: 2px;\n  }\n\n  .gravity-button:not([disabled]):hover {\n    background-color: ").concat(Et.Purple.D0,';\n  }\n</style>\n\n<button class="gravity-button">\n  <slot id="button-content"></slot>\n</button>\n');const Mo=".visually-hidden{position:absolute!important;overflow:hidden!important;clip:rect(0 0 0 0)!important;height:1px!important;width:1px!important;margin:-1px!important;padding:0!important;border:0!important}.button-text-spacing{margin-right:2px}",Bo='<svg viewBox="0 -2 341 81" xmlns="http://www.w3.org/2000/svg" height="20px" width="85px">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M227.297 0C220.448 0 214.896 5.47237 214.896 12.2229V67.8125C214.896 74.563 220.448 80.0354 227.297 80.0354H328.357C335.206 80.0354 340.758 74.563 340.758 67.8125V12.2229C340.758 5.47237 335.206 0 328.357 0H227.297ZM244.999 55.8917V41.8012H253.993C262.21 41.8012 266.579 37.2604 266.579 30.379C266.579 23.4976 262.21 19.3782 253.993 19.3782H239.205V55.8917H244.999ZM244.999 24.8084H252.663C257.982 24.8084 260.595 26.9617 260.595 30.5663C260.595 34.1708 258.077 36.3242 252.9 36.3242H244.999V24.8084ZM276.795 56.6407C281.212 56.6407 284.109 54.7214 285.439 51.4445C285.819 55.0959 288.052 56.9684 292.896 55.7044L292.944 51.819C290.996 52.0063 290.616 51.3041 290.616 49.2912V39.7415C290.616 34.124 286.864 30.8003 279.93 30.8003C273.09 30.8003 269.148 34.1708 269.148 39.8819H274.468C274.468 37.1668 276.415 35.5284 279.835 35.5284C283.444 35.5284 285.107 37.0732 285.059 39.7415V40.9586L278.932 41.614C272.045 42.3629 268.246 44.9376 268.246 49.4316C268.246 53.1298 270.905 56.6407 276.795 56.6407ZM277.982 52.4276C274.99 52.4276 273.803 50.836 273.803 49.2443C273.803 47.091 276.273 46.1079 281.117 45.5462L284.917 45.1249C284.679 49.2443 281.877 52.4276 277.982 52.4276ZM310.537 57.7174C308.115 63.5221 304.22 65.2541 298.141 65.2541H295.528V60.4793H298.331C301.655 60.4793 303.27 59.4494 305.028 56.5002L294.246 31.5493H300.23L307.925 49.7593L314.764 31.5493H320.606L310.537 57.7174Z" fill="white" />\n  <path d="M29.5136 35.1798C21.5797 33.4835 18.0451 32.8197 18.0451 29.8064C18.0451 26.9722 20.4371 25.5604 25.221 25.5604C29.4282 25.5604 32.5036 27.3726 34.7674 30.9232C34.9382 31.1972 35.2906 31.292 35.5789 31.1445L44.506 26.6983C44.8263 26.5402 44.9438 26.1399 44.7623 25.8343C41.0569 19.5022 34.2121 16.0358 25.1996 16.0358C13.3574 16.0358 6 21.7885 6 30.9338C6 40.648 14.9591 43.1029 22.9038 44.7992C30.8484 46.4955 34.3936 47.1592 34.3936 50.1725C34.3936 53.1858 31.8095 54.6082 26.6518 54.6082C21.8893 54.6082 18.3548 52.4589 16.2191 48.2866C16.059 47.981 15.6852 47.8546 15.3756 48.0127L6.46985 52.364C6.16017 52.5221 6.03203 52.8908 6.19221 53.2069C9.72673 60.2134 16.9773 64.1538 26.6625 64.1538C38.996 64.1538 46.4494 58.496 46.4494 49.0663C46.4494 39.6365 37.4476 36.8972 29.5136 35.2009V35.1798Z" fill="white" />\n  <path d="M77.3525 16.0358C72.291 16.0358 67.8168 17.8059 64.6026 20.9561C64.3997 21.1458 64.0687 21.0088 64.0687 20.7349V0.621625C64.0687 0.273937 63.791 0 63.4387 0H52.2692C51.9168 0 51.6391 0.273937 51.6391 0.621625V63.0476C51.6391 63.3952 51.9168 63.6692 52.2692 63.6692H63.4387C63.791 63.6692 64.0687 63.3952 64.0687 63.0476V35.6644C64.0687 30.3754 68.1798 26.319 73.7219 26.319C79.2639 26.319 83.279 30.2911 83.279 35.6644V63.0476C83.279 63.3952 83.5566 63.6692 83.909 63.6692H95.0785C95.4309 63.6692 95.7085 63.3952 95.7085 63.0476V35.6644C95.7085 24.1591 88.0628 16.0464 77.3525 16.0464V16.0358Z" fill="white" />\n  <path d="M118.389 14.2552C112.324 14.2552 106.622 16.0779 102.542 18.7224C102.265 18.9016 102.169 19.2703 102.34 19.5548L107.262 27.8466C107.444 28.1416 107.828 28.247 108.127 28.0679C111.224 26.2241 114.769 25.2653 118.389 25.2864C128.138 25.2864 135.303 32.0716 135.303 41.0377C135.303 48.6763 129.569 54.3342 122.297 54.3342C116.371 54.3342 112.26 50.9311 112.26 46.1266C112.26 43.3767 113.445 41.122 116.531 39.5311C116.851 39.3625 116.969 38.9727 116.777 38.6671L112.132 30.9126C111.982 30.6598 111.662 30.5439 111.373 30.6492C105.148 32.925 100.78 38.4037 100.78 45.7579C100.78 56.8839 109.761 65.1863 122.287 65.1863C136.916 65.1863 147.434 55.1876 147.434 40.8481C147.434 25.476 135.197 14.2446 118.368 14.2446L118.389 14.2552Z" fill="white" />\n  <path d="M180.098 15.9515C174.449 15.9515 169.409 18.006 165.725 21.6304C165.522 21.8306 165.191 21.6831 165.191 21.4092V17.0473C165.191 16.6996 164.914 16.4256 164.561 16.4256H153.68C153.328 16.4256 153.05 16.6996 153.05 17.0473V79.3784C153.05 79.7261 153.328 80 153.68 80H164.849C165.202 80 165.48 79.7261 165.48 79.3784V58.9385C165.48 58.6645 165.811 58.5276 166.013 58.7067C169.687 62.0782 174.545 64.0485 180.109 64.0485C193.211 64.0485 203.43 53.5862 203.43 39.9947C203.43 26.4032 193.2 15.941 180.109 15.941L180.098 15.9515ZM177.995 53.4914C170.541 53.4914 164.892 47.6439 164.892 39.9104C164.892 32.177 170.53 26.3295 177.995 26.3295C185.459 26.3295 191.086 32.0822 191.086 39.9104C191.086 47.7387 185.533 53.4914 177.984 53.4914H177.995Z" fill="white" />\n</svg>\n\n';class Uo extends W{constructor(){super(...arguments),u(this,"fragment",null),u(this,"button",null)}static get observedAttributes(){return["disabled"]}async connectedCallback(){this.render(),$o()}attributeChangedCallback(t,n,r){super.attributeChangedCallback(t,n,r,this.button)}disconnectedCallback(){this.button&&this.removeChild(this.button)}createAndAppendStyleFragment(){if(!this.button)return;this.fragment=document.createDocumentFragment();const t=document.createElement("style");t.innerHTML=Mo,this.fragment.append(t,this.button),this.appendChild(this.fragment)}addButtonContent(){if(!this.button)return;const t=document.createElement("span");t.textContent="Buy with Shop Pay",t.className="visually-hidden",this.button.appendChild(t);const n=document.createElement("span");n.textContent="Buy with",n.className="button-text-spacing",this.button.appendChild(n);const r=new DOMParser().parseFromString(Bo,"image/svg+xml").documentElement;this.button.appendChild(r)}async handleClick(t){if(t.preventDefault(),this.disabled||!this.button||this.button.getAttribute("aria-disabled"))return;this.disabled=!0;const[n,r]=await Promise.all([this.i18n,this.dataSource]);try{const{outOfStock:a,cart:i}=await j({element:this,instrumentName:b.MoreOptions,dataSource:r,willHandleErrorCodes(o){return o.length===1&&o[0]===w.InvalidQuantity},isShopPayRequest:!0});if(m.sheetClicked({instrument:b.ShopPay,checkoutToken:$t(i),result:"success"}),a){$(n.translate("error_dialogs.checkout.title"),n.translate("error_dialogs.product.out_of_stock"));return}ot(i.checkoutUrl)}catch(a){g.notify(new zo("An error occurred when attempting to a cart using the Shop Pay Button. Details: ".concat(a))),m.sheetClicked({instrument:b.ShopPay,result:"failed"}),$(n.translate("error_dialogs.checkout.title"),n.translate("error_dialogs.checkout.generic_error"))}}async render(){this.button||(this.button=document.createElement("gravity-button")),this.fragment||this.createAndAppendStyleFragment();const t=await this.classNames;this.addButtonContent(),this.button.className=t,this.disabled&&this.button.setAttribute("aria-disabled","true"),this.button.onclick=n=>this.handleClick(n),this.appendChild(this.button)}}class zo extends Error{constructor(){super(...arguments),u(this,"name","ShopPayButtonError")}}var qo=Object.defineProperty,Ho=Object.getOwnPropertyDescriptor,Vo=(e,t,n,r)=>{for(var a=r>1?void 0:r?Ho(t,n):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(a=(r?o(t,n,a):o(a))||a);return r&&a&&qo(t,n,a),a};class Rn extends K{static walletName(){return"shopify_pay"}constructor(t){super(t)}getWebComponentName(){return"shop-pay-button"}getWebComponentClass(){return Uo}getInstrumentName(){return b.ShopPay}getLoadEligibility(){return{eligible:!0}}}Vo([ye("Shop Pay")],Rn.prototype,"getLoadEligibility",1);const Wo=[Aa,_a,fe,wt,ae,Rn],jo=new Map(Wo.map(e=>[e.walletName(),t=>new e(t)]));function kt(e){const t=jo.get(e.name);return t?t(e):(console.debug("Can't build wallet with name ".concat(e.name)),null)}function Ko(e){return e.map(t=>kt(t)).filter(Boolean)}const Ln="dynamic-checkout .wallet-button-fade-in,cart-wallet-buttons .wallet-button-fade-in{animation:animation-fade-in .3s cubic-bezier(.1,.79,1,1)}dynamic-checkout .shopify-payment-button__button,cart-wallet-buttons .shopify-payment-button__button{cursor:pointer}@keyframes animation-fade-in{0%{opacity:0}to{opacity:1}}button[aria-disabled=true]{opacity:.5;cursor:not-allowed}",Go=".shopify-payment-button__button--hidden{visibility:hidden}.shopify-payment-button__button{border-radius:4px;border:none;box-shadow:0 0 0 0 transparent;color:#fff;cursor:pointer;display:block;font-size:1em;font-weight:500;line-height:1;text-align:center;width:100%;min-height:44px;transition:background .2s ease-in-out}.shopify-payment-button__button[disabled]{opacity:.6;cursor:default}.shopify-payment-button__button--unbranded{background-color:#1990c6;padding:1em 2em}.shopify-payment-button__button--unbranded:hover:not([disabled]){background-color:#136f99}.shopify-payment-button__more-options{background:transparent;border:0 none;cursor:pointer;display:block;font-size:1em;margin-top:1em;text-align:center;text-decoration:underline;width:100%}.shopify-payment-button__more-options.shopify-payment-button__skeleton{width:50%;margin-left:25%;margin-right:25%}.shopify-payment-button__more-options[disabled]{opacity:.6;cursor:default}.shopify-payment-button__button.shopify-payment-button__button--branded{display:flex;flex-direction:column;position:relative;z-index:1}.shopify-payment-button__button.shopify-payment-button__button--branded .shopify-cleanslate{flex:1!important;display:flex!important;flex-direction:column!important}.shopify-payment-button__button.button.loading{position:relative;color:transparent}.shopify-payment-button__button.button.loading>.loading-overlay__spinner{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;height:100%;display:flex;align-items:center}.shopify-payment-button__button.button.loading>.loading-overlay__spinner .spinner{width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}.button.loading>.loading-overlay__spinner .path{stroke:#fff}.shopify-payment-button__button .loading-overlay__spinner{width:1.8rem;display:inline-block}.shopify-payment-button__button .spinner{animation:shopify-rotator 1.4s linear infinite}@keyframes shopify-rotator{0%{transform:rotate(0)}to{transform:rotate(270deg)}}.shopify-payment-button__button .path{stroke-dasharray:280;stroke-dashoffset:0;transform-origin:center;stroke:#121212;animation:shopify-dash 1.4s ease-in-out infinite}@media screen and (forced-colors: active){.shopify-payment-button__button .path{stroke:CanvasText}}@keyframes shopify-dash{0%{stroke-dashoffset:280}50%{stroke-dashoffset:75;transform:rotate(135deg)}to{stroke-dashoffset:280;transform:rotate(450deg)}}@keyframes walletsLoadingSkeleton{50%{opacity:1}75%{opacity:.5}to{opacity:1}}.shopify-payment-button__skeleton{animation:walletsLoadingSkeleton 4s ease infinite;animation-delay:-.168s;background-color:#dedede;box-sizing:border-box;text-decoration:none!important}";class Yo{constructor(t,n,r){this.getElement=t,this.apiClient=n,this.instrumentName=r}async getCart({isShopPayRequest:t}={}){const n=this.getElement(),r=hn(n);if(!r)throw new Error("[".concat(this.instrumentName,"] unable to find product form"));const a=yt(nr),i=t?{walletPreferences:["shop_pay"]}:void 0,{data:o,errors:s}=await this.apiClient.createCart(E(f({},r),{discountCodes:a?[a]:[],buyerIdentity:i}));if(!o)throw new Error("Failed to create cart: No cart returned");return{cart:o,errors:s}}}function On({instanceNumber:e,styleId:t,styles:n,cssFileName:r}){var a,i;e===1&&(i=(a=window.Shopify)==null?void 0:a.PaymentButton)!=null&&i.isStorefrontPortableWallets&&(Qo({styleId:t,styles:n,cssFileName:r})||Jo({styleId:t,styles:n}))}function Qo({styleId:e,styles:t,cssFileName:n}){return!!document.querySelector("style#".concat(e))}function Jo({styleId:e,styles:t}){const n=document.createElement("style");n.id=e,n.innerHTML=t,document.head.appendChild(n)}const Qe=2e3,xt=class ii extends pe{constructor(){super(),u(this,"instanceNumber",++ii.instanceCount),u(this,"formObserver"),u(this,"dataSource"),u(this,"wrapper"),this.wrapper=document.createElement("div"),this.formObserver=new ba(this,({disabled:t,hasSellingPlan:n})=>{this.disabled=t,this.hasSellingPlan=n,this.wrapper&&(this.isShippingRequired=Xo(this.wrapper,this.variantParams))}),ce({shop:{shopId:this.shopId}}),On({instanceNumber:this.instanceNumber,styleId:"shopify-dynamic-checkout",styles:Go,cssFileName:"dynamic-checkout-base.css"})}static get observedAttributes(){return["access-token","disabled","has-selling-plan","requires-shipping"]}async connectedCallback(){var t,n,r,a;try{if((n=(t=this.wrapper)==null?void 0:t.children)!=null&&n.length)return;if(!this.validateRenderingSurface()){this.clearUI();return}this.instanceNumber===1&&m.initStarted();const i=Mt(D.ButtonDisplay,"dc:".concat(this.instanceNumber));this.i18n=Ot();const o=()=>this.wrapper,s=await this.loadWallet(),l=(s==null?void 0:s.getInstrumentName())===b.ApplePay||(s==null?void 0:s.getInstrumentName())===b.PayPal;this.apiClient=new zt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,withCarrierRates:l}),this.dataSource=new Yo(o,this.apiClient,(r=s==null?void 0:s.getInstrumentName())!=null?r:b.BuyItNow);const c=(a=s==null?void 0:s.getInstrumentName())!=null?a:b.BuyItNow,d=s==null?void 0:s.createWebComponent({walletContainer:this,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,classNames:Zo(c),callToAction:"true",pageType:k.ProductPage,onRendered:()=>m.instrumentLoaded({instrument:c,measurement:i()})});if(!d)throw new Error("[DynamicCheckout] No web component found");this.render(d,c),this.formObserver.setupMutationObservers(),m.initCompleted({result:"success"}),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(i){if(this.clearUI(),i instanceof Error&&i.name==="DeveloperError"){const o=i;console.error(o),m.initCompleted({result:"failed",eventType:"[".concat(o.name,"]: ").concat(o.code)});return}m.initCompleted({result:"failed"}),g.notify(i)}}async attributeChangedCallback(t,n,r){n!==r&&(de(this,t,r),t==="has-selling-plan"&&this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n))}render(t,n){if(!this.wrapper)throw new Error("[DynamicCheckout] tried to render with no wrapper element");this.clearUI(),this.wrapper=document.createElement("div");const r=document.createElement("style");r.innerHTML=Ln,this.wrapper.className="wallet-button-fade-in",this.wrapper.appendChild(t),this.renderMorePaymentOptionsLink(n);const a=new DocumentFragment;a.appendChild(r),a.appendChild(this.wrapper),this.appendChild(a)}renderMorePaymentOptionsLink(t){var n,r;if(t===b.BuyItNow)return;const a=document.createElement("more-payment-options-link");nt(a,{"buyer-country":(n=this.buyerCountry)!=null?n:"","access-token":(r=this.accessToken)!=null?r:"",disabled:String(this.disabled)}),a.setDataSource(this.dataSource),a.setI18n(this.i18n),a.setClassNames(Gt.MORE_PAYMENT_OPTION_BUTTON),this.wrapper.appendChild(a)}clearUI(){this.innerHTML=""}validateRenderingSurface(){return me(this)!=null}async loadWallet(){const t=wa(this.recommendedWallet,this.fallbackWallet,"DynamicCheckout");return await ti(E(f({},t),{instanceNumber:this.instanceNumber}))}};u(xt,"instanceCount",0);let oe=xt;function Zo(e){return e===b.BuyItNow?Gt.UNBRANDED_BUTTON:Gt.BRANDED_BUTTON}function Xo(e,t){var n;const r=hn(e);return!!((n=t.find(a=>a.id===Number(r==null?void 0:r.variantId)))!=null&&n.requiresShipping)}async function ti({recommendedWallet:e,fallbackWallet:t,instanceNumber:n}){const r=e?kt(e):null,a=kt(t);if(he(r)){const i=Xt({walletInstrument:r,instanceNumber:n}),o="timeout",s=await Promise.race([i,new Promise(l=>setTimeout(()=>l(o),Qe))]);if(s===o)m.instrumentSDKLoaded({instrument:r.getInstrumentName(),measurement:Qe,result:"timeout"});else if(s instanceof K)return s}return a&&Xt({walletInstrument:a,instanceNumber:n})}F("dynamic-checkout",oe),F("more-payment-options-link",Wr,{isChildCustomElement:!0});const ei=e=>{const t=new PerformanceObserver(n=>{n.getEntriesByType("resource").some(r=>r.name.includes(pt.CartUpdate)||r.name.includes(pt.CartChange)||r.name.includes(pt.CartAdd)||r.name.includes(pt.CartClear))&&e()});return t.observe({entryTypes:["resource"]}),t},ni=".additional-checkout-buttons,.additional-checkout-buttons--vertical{container-type:inline-size;container-name:acb}.wallet-cart-button-container,.wallet-cart-button{min-height:42px;width:150px;max-width:400px;border-radius:4px;overflow:hidden}.wallet-cart-grid{margin:0;padding:0;display:flex;gap:1rem;justify-content:flex-end;flex-direction:row}.additional-checkout-buttons--vertical .wallet-cart-grid{justify-content:flex-start;flex-direction:column}.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button{width:100%}@container acb (width >= 150px) and (width <= 400px){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button{width:100%}}@container acb (width <= calc(300px + 1rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button{width:100%}}@container acb (width <= calc(450px + 2rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button{width:100%}}@container acb (width <= calc(600px + 3rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button{width:100%}}@container acb (width <= calc(750px + 4rem)){.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button{width:100%}}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)){justify-content:flex-start;flex-direction:column}.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container,.wallet-cart-grid:has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button{width:100%}@media screen and (max-width: 750px){.wallet-cart-grid{justify-content:flex-start;flex-direction:column}.wallet-cart-grid .wallet-cart-button-container,.wallet-cart-grid .wallet-cart-button{max-width:none;width:100%}}@supports (not (container-type: inline-size)) or (not (selector(:has(*)))){.wallet-cart-grid{justify-content:flex-start;flex-direction:column;gap:0px}.wallet-cart-button-container{width:100%;margin-bottom:10px}.wallet-cart-grid .wallet-cart-button{width:100%}}@keyframes walletsLoadingSkeleton{50%{opacity:1}75%{opacity:.5}to{opacity:1}}.wallet-cart-button__skeleton{animation:walletsLoadingSkeleton 4s ease infinite;animation-delay:-.168s;background-color:#dedede;box-sizing:border-box;text-decoration:none!important}";class ri{constructor(t,n){this.cartToken=t,this.apiClient=n}async getCart(){return{cart:await this.apiClient.fetchCart("gid://shopify/Cart/".concat(this.cartToken)),errors:[]}}}const Rt=class si extends pe{constructor(){super(),u(this,"instanceNumber",++si.instanceCount),u(this,"cartObserver",null),u(this,"dataSource",null),u(this,"wrapper"),ce({shop:{shopId:this.shopId,cartId:this.cartId}}),On({instanceNumber:this.instanceNumber,styleId:"shopify-dynamic-checkout-cart-grid",styles:ni,cssFileName:"cart-wallet-buttons-base.css"}),this.wrapper=document.createElement("div")}static get observedAttributes(){return["access-token","has-selling-plan","requires-shipping"]}createDataSource(t){const n=yt("cart");if(!n)throw new Error("[CartWalletButtons] cart cookie does not exist");const r=Ot(),a=new zt({accessToken:this.accessToken,country:this.buyerCountry,locale:r.locale,withCarrierRates:t}),i=new ri(n,a);this.dataSource=i,this.apiClient=a,this.i18n=r}async createWebComponents({shouldRefetchCartAttributes:t}){if(!this.walletConfigs)throw new Error("[CartWalletButtons] walletConfigs does not exist");const n=da(this.walletConfigs,"CartWalletButtons");if(!(n instanceof Array))throw new Error("[CartWalletButtons] invalid walletConfigs found");const r=n.some(o=>o.name==="apple_pay"||o.name==="paypal");this.createDataSource(r),t&&await this.updateAttributes();const a=D.ButtonDisplay,i=o=>"".concat(o,":").concat(this.instanceNumber);return(await ai({walletConfigs:n,instanceNumber:this.instanceNumber,startButtonDisplayBenchmark:o=>Bt(a,i(o))})).map(o=>{const s=o.getInstrumentName();return o.createWebComponent({walletContainer:this,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,classNames:Xn,pageType:k.CartPage,onRendered:()=>m.instrumentLoaded({instrument:s,measurement:rt(a,i(s))})})})}async cartChangedCallback(){try{const t=yt("cart");if(!this.dataSource&&t){await this.render({shouldRefetchCartAttributes:!0});return}else if(!t){m.cartTokenMissing({reason:"cartChangedCallback"});return}await this.updateAttributes()}catch(t){this.innerHTML="",g.notify(t)}}async updateAttributes(){const{cart:t}=await this.dataSource.getCart();if(!(t!=null&&t.id))throw new Error("[".concat(this.updateAttributes,"] received invalid cart"));this.hasSellingPlan=t.lineItems.some(n=>n.sellingPlanAllocation!=null),this.isShippingRequired=t.lineItems.some(n=>n.merchandise.requiresShipping)}async connectedCallback(){try{if(N({event:T.CartInitCalled}),this.cartObserver=ei(()=>this.cartChangedCallback()),!yt("cart")){m.cartTokenMissing({reason:"connectedCallback"});return}await this.render({shouldRefetchCartAttributes:!1})}catch(t){this.innerHTML="",g.notify(t)}}disconnectedCallback(){var t;(t=this.cartObserver)==null||t.disconnect()}async attributeChangedCallback(t,n,r){n!==r&&(de(this,t,r),t==="has-selling-plan"&&this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n))}async render({shouldRefetchCartAttributes:t}){const n=Mt(D.ButtonDisplay,"cart:".concat(this.instanceNumber)),r=await this.createWebComponents({shouldRefetchCartAttributes:t});if(this.innerHTML="",r.length===0)return;const a=document.createElement("style");a.innerHTML=Ln,this.wrapper=document.createElement("div"),this.wrapper.className="wallet-button-fade-in";const i=document.createElement("div");i.className="wallet-cart-grid",i.setAttribute("data-shopify-buttoncontainer","true"),r.forEach(s=>{const l=document.createElement("div");l.className="wallet-cart-button-container",l.appendChild(s),i.appendChild(l)}),this.wrapper.appendChild(i),this.toggleBuyerConsent(this.wrapper,this.apiClient,this.i18n);const o=new DocumentFragment;o.appendChild(a),o.appendChild(this.wrapper),this.appendChild(o),N({event:T.InstrumentLoaded,instrumentId:"CartWalletButtons",ttl:n()})}};u(Rt,"instanceCount",0);let ie=Rt;async function ai({walletConfigs:e,instanceNumber:t,startButtonDisplayBenchmark:n=()=>{}}){const r=pa(Ko(e));return(await Promise.all(r.map(a=>(n(a.getInstrumentName()),Xt({walletInstrument:a,instanceNumber:t}))))).filter(a=>a)}F("cart-wallet-buttons",ie);class oi{getCart(){throw new Error('[NoOpDataSource] Unexpected call to "getCart"')}}const Lt=class li extends pe{constructor(){super(),u(this,"instanceNumber",++li.instanceCount),ce({shop:{shopId:this.shopId}})}get walletConfig(){return this.getAttribute("wallet-config")}async connectedCallback(){try{if(this.children.length)return;this.instanceNumber===1&&m.initStarted();const t=Mt(D.ButtonDisplay,"dc:".concat(this.instanceNumber)),n=ha(this.walletConfig,"WalletButton");if(!n)throw new Qr("[WalletButton] No config provided.");const r=kt(n);if(!r||!await this.eligibleToShow(r))return;const a=r.getInstrumentName();this.i18n=Ot(),this.apiClient=new zt({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale});const i=this.createWebComponent(r,this.i18n,this.apiClient,a,t);this.innerHTML="",this.appendChild(i),m.initCompleted({result:"success"}),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(t){this.innerHTML="",m.initCompleted({result:"failed"}),g.notify(t)}}createWebComponent(t,n,r,a,i){const o=t.createWebComponent({walletContainer:this,dataSource:new oi,i18n:n,apiClient:r});return o.onRendered=()=>{m.instrumentLoaded({instrument:a,measurement:i()})},o}async eligibleToShow(t){return!(!he(t)||(await t.loadWalletSDK(),!t.getPartnerSDKEligibility().eligible))}};u(Lt,"instanceCount",0);let se=Lt;F("shopify-wallet-button",se),Jn(g),Zn(g),m.startExporter();
